# Implementation Plan: ATR Multiplier 2.5 ë‹¨ì¼ ê³ ì • WFO ìž¬ì‹¤í—˜

> ìž‘ì„±/ìš´ì˜ ê·œì¹™(SoT): ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

**ìƒíƒœ**: âœ… Done

---

ðŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ðŸš«

**ìƒíƒœ ì˜µì…˜**: ðŸŸ¡ Draft / ðŸ”„ In Progress / âœ… Done

**Done ì²˜ë¦¬ ê·œì¹™**:

- âœ… Done ì¡°ê±´: DoD ëª¨ë‘ [x] + `skipped=0` + `failed=0`
- âš ï¸ **ìŠ¤í‚µì´ 1ê°œë¼ë„ ì¡´ìž¬í•˜ë©´ Done ì²˜ë¦¬ ê¸ˆì§€ + DoD í…ŒìŠ¤íŠ¸ í•­ëª© ì²´í¬ ê¸ˆì§€**
- ìƒì„¸: [docs/CLAUDE.md](../CLAUDE.md) ì„¹ì…˜ 3, 5 ì°¸ê³ 

---

**ìž‘ì„±ì¼**: 2026-02-27 (KST)
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-27 (KST)
**ê´€ë ¨ ë²”ìœ„**: backtest (constants, WFO)
**ê´€ë ¨ ë¬¸ì„œ**: `src/qbt/backtest/CLAUDE.md`, `scripts/CLAUDE.md`, `tests/CLAUDE.md`

---

## 0) ê³ ì • ê·œì¹™ (ì´ planì€ ë°˜ë“œì‹œ ì•„ëž˜ ê·œì¹™ì„ ë”°ë¥¸ë‹¤)

> ðŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ðŸš«
> ì´ ì„¹ì…˜(0)ì€ ì§€ì›Œì§€ë©´ ì•ˆ ë  ë¿ë§Œ ì•„ë‹ˆë¼ **ë¬¸êµ¬ê°€ ìˆ˜ì •ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
> ê·œì¹™ì˜ ìƒì„¸ ì •ì˜/ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

- `poetry run python validate_project.py`ëŠ” **ë§ˆì§€ë§‰ Phaseì—ì„œë§Œ ì‹¤í–‰**í•œë‹¤. ì‹¤íŒ¨í•˜ë©´ ì¦‰ì‹œ ìˆ˜ì • í›„ ìž¬ê²€ì¦í•œë‹¤.
- Phase 0ì€ "ë ˆë“œ(ì˜ë„ì  ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸)" í—ˆìš©, Phase 1ë¶€í„°ëŠ” **ê·¸ë¦° ìœ ì§€**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- ì´ë¯¸ ìƒì„±ëœ planì€ **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™¸ ìˆ˜ì • ê¸ˆì§€**í•œë‹¤.
- ìŠ¤í‚µì€ ê°€ëŠ¥í•˜ë©´ **Phase ë¶„í•´ë¡œ ì œê±°**í•œë‹¤.

---

## 1) ëª©í‘œ(Goal)

- [x] `DEFAULT_WFO_ATR_MULTIPLIER_LIST`ë¥¼ `[2.5]`ë¡œ ë³€ê²½í•˜ì—¬ ATR mult 2.5 ê°•ì œ ì ìš©
- [x] buffer_zone_atr_tqqq WFO 3-Mode ìž¬ì‹¤í–‰
- [x] ê²°ê³¼ ë¶„ì„: ì„±ê³µ ê¸°ì¤€(Stitched MDD â‰¤ -50% AND Calmar â‰¥ 0.35) íŒì • â†’ **ì‹¤íŒ¨**
- [x] íŒì • ê²°ê³¼ì— ë”°ë¥¸ ìƒìˆ˜ í™•ì • ë˜ëŠ” ë³µì› â†’ `[2.5, 3.0]` ì›ë³µ
- [x] `buffer_zone_tqqq_improvement_log.md` ê²°ê³¼ ê¸°ë¡

## 2) ë¹„ëª©í‘œ(Non-Goals)

- WFO ìŠ¤í¬ë¦½íŠ¸ êµ¬ì¡° ë³€ê²½ (3-Mode ì‹¤í–‰ ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€)
- Fully Fixed ëª¨ë“œ ì œê±° (ìŠ¤í¬ë¦½íŠ¸ê°€ ìžë™ ì‹¤í–‰í•˜ì§€ë§Œ ë¶„ì„ì—ì„œ ì œì™¸)
- ìƒˆë¡œìš´ ATR íŒŒë¼ë¯¸í„° ë˜ëŠ” ì „ëžµ ì¶”ê°€
- í…ŒìŠ¤íŠ¸ ì½”ë“œ ë³€ê²½ (ìƒìˆ˜ ë³€ê²½ë§Œìœ¼ë¡œ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ ì—†ìŒ)

## 3) ë°°ê²½/ë§¥ë½(Context)

### í˜„ìž¬ ë¬¸ì œì  / ë™ê¸°

- í˜„ìž¬ ATR grid `[2.5, 3.0]`ì—ì„œ 33/33 ë°ì´í„° í¬ì¸íŠ¸ ì „ë¶€ `3.0` ì„ íƒ
- Dynamic Stitched CAGR 16.09%, **MDD -52.95%** â†’ ëª©í‘œ -50%ì— **2.95pp ë¯¸ë‹¬**
- mult 2.5ëŠ” ë” ë¹¡ë¹¡í•œ ìŠ¤íƒ‘ â†’ ë” ë¹ˆë²ˆí•œ ì²­ì‚° â†’ MDD ê°ì†Œ ê°€ëŠ¥ì„±
- ë‹¨, ISì—ì„œ ì´ë¯¸ íƒˆë½í•œ íŒŒë¼ë¯¸í„°ì´ë¯€ë¡œ CAGR ì¶”ê°€ í•˜ë½ì€ ê±°ì˜ í™•ì‹¤

### í˜„ìž¬ ê²°ê³¼ ë² ì´ìŠ¤ë¼ì¸ (ë¹„êµ ê¸°ì¤€)

| Mode | Stitched CAGR | Stitched MDD | Stitched Calmar |
|------|---------------|--------------|-----------------|
| Dynamic | 16.09% | -52.95% | 0.30 |
| Sell Fixed | 11.32% | -54.31% | 0.21 |
| Fully Fixed | 8.40% | -51.75% | 0.16 |

### ì˜í–¥ë°›ëŠ” ê·œì¹™(ë°˜ë“œì‹œ ì½ê³  ì „ì²´ ìˆ™ì§€)

> ì•„ëž˜ ë¬¸ì„œì— ê¸°ìž¬ëœ ê·œì¹™ì„ **ëª¨ë‘ ìˆ™ì§€**í•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.

- `src/qbt/backtest/CLAUDE.md`: ë°±í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ ê·œì¹™
- `scripts/CLAUDE.md`: CLI ê³„ì¸µ ê·œì¹™
- `tests/CLAUDE.md`: í…ŒìŠ¤íŠ¸ ê·œì¹™
- ë£¨íŠ¸ `CLAUDE.md`: ìƒìˆ˜ ê´€ë¦¬, ì½”ë”© í‘œì¤€

## 4) ì™„ë£Œ ì¡°ê±´(Definition of Done)

> Doneì€ "ì„œìˆ "ì´ ì•„ë‹ˆë¼ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ"ë¡œë§Œ íŒë‹¨í•©ë‹ˆë‹¤. (ì •ì˜/ì˜ˆì™¸ëŠ” docs/CLAUDE.md)

- [x] `DEFAULT_WFO_ATR_MULTIPLIER_LIST` ë³€ê²½ ì™„ë£Œ
- [x] WFO 3-Mode ì‹¤í–‰ ì™„ë£Œ (buffer_zone_atr_tqqq)
- [x] ê²°ê³¼ ë¶„ì„ ë° ì„±ê³µ ê¸°ì¤€ íŒì • ì™„ë£Œ â†’ **ì‹¤íŒ¨** (Dynamic MDD -66.66%, Calmar 0.12)
- [x] íŒì • ê²°ê³¼ì— ë”°ë¼ ìƒìˆ˜ í™•ì • ë˜ëŠ” `[2.5, 3.0]`ìœ¼ë¡œ ë³µì› â†’ ì›ë³µ ì™„ë£Œ
- [x] `buffer_zone_tqqq_improvement_log.md` Â§1, Â§2.2, Â§3.5, Â§6, Â§8 ì—…ë°ì´íŠ¸
- [ ] `poetry run python validate_project.py` í†µê³¼ (failed=0, skipped=0)
- [ ] `poetry run black .` ì‹¤í–‰ ì™„ë£Œ

## 5) ë³€ê²½ ë²”ìœ„(Scope)

### ë³€ê²½ ëŒ€ìƒ íŒŒì¼

- `src/qbt/backtest/constants.py` (1ì¤„: `DEFAULT_WFO_ATR_MULTIPLIER_LIST`)
- `buffer_zone_tqqq_improvement_log.md` (ê²°ê³¼ ê¸°ë¡)

### ë°ì´í„°/ê²°ê³¼ ì˜í–¥

- `storage/results/backtest/buffer_zone_atr_tqqq/` í•˜ìœ„ 7ê°œ íŒŒì¼ ë®ì–´ì“°ê¸°:
  - `walkforward_dynamic.csv`, `walkforward_sell_fixed.csv`, `walkforward_fully_fixed.csv`
  - `walkforward_equity_dynamic.csv`, `walkforward_equity_sell_fixed.csv`, `walkforward_equity_fully_fixed.csv`
  - `walkforward_summary.json`
- ê¸°ì¡´ ê²°ê³¼ëŠ” gitìœ¼ë¡œ ë³µì› ê°€ëŠ¥

### ê·¸ë¦¬ë“œ ì„œì¹˜ ê·œëª¨ ë³€í™”

- ê¸°ì¡´: 3Ã—3Ã—3Ã—4Ã—4Ã—2Ã—2 = **1,728 ì¡°í•©/ìœˆë„ìš°** (Dynamic/Sell Fixed)
- ë³€ê²½: 3Ã—3Ã—3Ã—4Ã—4Ã—2Ã—1 = **864 ì¡°í•©/ìœˆë„ìš°** (ì ˆë°˜ìœ¼ë¡œ ì¶•ì†Œ)

## 6) ë‹¨ê³„ë³„ ê³„íš(Phases)

### Phase 1 â€” ìƒìˆ˜ ë³€ê²½ + WFO ì‹¤í–‰

**ìž‘ì—… ë‚´ìš©**:

- [x] `src/qbt/backtest/constants.py:53`ì˜ `DEFAULT_WFO_ATR_MULTIPLIER_LIST`ë¥¼ `[2.5, 3.0]` â†’ `[2.5]`ë¡œ ë³€ê²½
- [x] WFO ì‹¤í–‰: `poetry run python scripts/backtest/run_walkforward.py --strategy buffer_zone_atr_tqqq`
- [x] `walkforward_summary.json` ì½ì–´ Dynamic/Sell Fixedì˜ stitched ì§€í‘œ í™•ì¸

---

### Phase 2 â€” ê²°ê³¼ ë¶„ì„ + ì˜ì‚¬ê²°ì •

**ìž‘ì—… ë‚´ìš©**:

- [x] ì„±ê³µ ê¸°ì¤€ íŒì •: **ì‹¤íŒ¨** (Dynamic MDD -66.66% >> -50%, Calmar 0.12 << 0.35)
- [x] íŒì • ê²°ê³¼ì— ë”°ë¥¸ ì¡°ì¹˜: `[2.5, 3.0]`ìœ¼ë¡œ ì›ë³µ + `git restore` ê²°ê³¼ íŒŒì¼ ë³µêµ¬
- [x] `buffer_zone_tqqq_improvement_log.md` ì—…ë°ì´íŠ¸:
  - Â§1 TL;DR: ì‹¤í—˜ ì‹¤íŒ¨ ê²°ê³¼ ë°˜ì˜
  - Â§2.2: ìƒˆ í–‰ ì¶”ê°€ (ATR mult 2.5 ê²°ê³¼)
  - Â§3.5: ê¸°ê° ì‚¬ìœ  ìƒì„¸ ê¸°ë¡
  - Â§6: ì‹¤í—˜ 1 ìƒíƒœ "ëŒ€ê¸°" â†’ "ì‹¤íŒ¨Â·ê¸°ê°"
  - Â§8: ë³€ê²½ ë¡œê·¸ í•­ëª© ì¶”ê°€

---

### Phase 3 (Final) â€” ìµœì¢… ê²€ì¦

**ìž‘ì—… ë‚´ìš©**:

- [x] `poetry run black .` ì‹¤í–‰ (ë³€ê²½ ì—†ìŒ)
- [x] DoD ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸
- [x] ì „ì²´ Phase ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ í™•ì •

**Validation**:

- [x] `poetry run python validate_project.py` (passed=358, failed=0, skipped=0)

#### Commit Messages (Final candidates) â€” 5ê°œ ì¤‘ 1ê°œ ì„ íƒ

1. ë°±í…ŒìŠ¤íŠ¸ / ATR multiplier 2.5 ë‹¨ì¼ ê³ ì • WFO ìž¬ì‹¤í—˜ ê²°ê³¼ ë°˜ì˜
2. ë°±í…ŒìŠ¤íŠ¸ / ATR mult 2.5 ê°•ì œ ì ìš© ì‹¤í—˜ ë° MDD ê°œì„  ê²€ì¦
3. ë°±í…ŒìŠ¤íŠ¸ / ATR ìŠ¤íƒ‘ íŒŒë¼ë¯¸í„° ìµœì í™” ì‹¤í—˜ (mult 2.5 ê³ ì •)
4. ë°±í…ŒìŠ¤íŠ¸ / WFO ATR multiplier ê·¸ë¦¬ë“œ ë³€ê²½ ë° ì‹¤í—˜ ê²°ê³¼ ê¸°ë¡
5. ë°±í…ŒìŠ¤íŠ¸ / ATR mult 2.5 ìž¬ì‹¤í—˜ ì™„ë£Œ ë° improvement log ì—…ë°ì´íŠ¸

## 7) ë¦¬ìŠ¤í¬(Risks)

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | ì™„í™”ì±… |
|--------|------|--------|
| WFO ì‹¤í–‰ ì‹œê°„ (864ì¡°í•© Ã— 11ìœˆë„ìš° Ã— 3ëª¨ë“œ) | ìˆ˜ì‹­ ë¶„ ì†Œìš” | ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ |
| ê¸°ì¡´ ê²°ê³¼ íŒŒì¼ ë®ì–´ì“°ê¸° | ì´ì „ ê²°ê³¼ ìœ ì‹¤ | gitìœ¼ë¡œ ë³µì› ê°€ëŠ¥ |
| mult 2.5 ê°•ì œë¡œ CAGR ëŒ€í­ í•˜ë½ | ì‹¤ìš©ì„± ì—†ëŠ” ê²°ê³¼ | ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ë³µì› |
| ISì—ì„œ ì´ë¯¸ íƒˆë½í•œ íŒŒë¼ë¯¸í„°ì˜ OOS ì„±ê³¼ ë¶ˆëŸ‰ | ê¸°ëŒ€ê°’ ë‚®ìŒ | ì‹¤í—˜ ëª©ì ì´ í™•ì¸ì´ë¯€ë¡œ ë¦¬ìŠ¤í¬ ìˆ˜ìš© |

## 8) ë©”ëª¨(Notes)

### í•µì‹¬ ê²°ì • ì‚¬í•­

- 33/33 ë°ì´í„° í¬ì¸íŠ¸ì—ì„œ mult=3.0ì´ IS ìµœì ì´ì—ˆìœ¼ë¯€ë¡œ, 2.5 ê°•ì œ ì ìš©ì€ Calmar ê¸°ì¤€ìœ¼ë¡œ ì—´ë“±í•œ ì„ íƒì„ ê°•ì œí•˜ëŠ” ì‹¤í—˜
- MDD ê°ì†Œê°€ CAGR í•˜ë½ë³´ë‹¤ í´ ê²½ìš°ì—ë§Œ ì„±ê³µ (Calmar â‰¥ 0.35 ê¸°ì¤€)
- Fully FixedëŠ” CAGR 8.4%ë¡œ ì‹¤ìš© ê°€ì¹˜ ì—†ì–´ ë¶„ì„ ì œì™¸ (ì‚¬ìš©ìž í•©ì˜)

### ì°¸ê³ 

- ì‹¤í—˜ ê³„íš ì›ë³¸: `buffer_zone_tqqq_improvement_log.md` Â§6 ì‹¤í—˜ #1
- ì„ í–‰ ATR êµ¬í˜„ ê³„íšì„œ: `docs/plans/PLAN_atr_trailing_stop_strategy.md` (âœ… Done)

### ì§„í–‰ ë¡œê·¸ (KST)

- 2026-02-27: Plan ìž‘ì„±
- 2026-02-27: WFO ì‹¤í–‰ ì™„ë£Œ, ê²°ê³¼ ë¶„ì„: **ì‹¤íŒ¨Â·ê¸°ê°**, ìƒìˆ˜ ë° ê²°ê³¼ íŒŒì¼ ì›ë³µ
- 2026-02-27: improvement log + plan ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸, validate passed=358
