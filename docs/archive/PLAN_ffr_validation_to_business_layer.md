# Implementation Plan: FFR ê²€ì¦ ë¡œì§ì„ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì¸µìœ¼ë¡œ ì´ë™

> ì‘ì„±/ìš´ì˜ ê·œì¹™(SoT): ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
> (ì´ í…œí”Œë¦¿ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì–‘ì‹ì˜ ê³„íšì„œë¥¼ ë§Œë“¤ ë•Œë„ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ í¬ì¸í„°ë¡œ ë‘ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.)

**ìƒíƒœ**: âœ… Done

---

ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«

**ìƒíƒœ ì˜µì…˜**: ğŸŸ¡ Draft / ğŸ”„ In Progress / âœ… Done

**Done ì²˜ë¦¬ ê·œì¹™**:

- âœ… Done ì¡°ê±´: DoD ëª¨ë‘ [x] + `skipped=0` + `failed=0`
- âš ï¸ **ìŠ¤í‚µì´ 1ê°œë¼ë„ ì¡´ì¬í•˜ë©´ Done ì²˜ë¦¬ ê¸ˆì§€ + DoD í…ŒìŠ¤íŠ¸ í•­ëª© ì²´í¬ ê¸ˆì§€**
- ìƒì„¸: [docs/CLAUDE.md](../CLAUDE.md) ì„¹ì…˜ 3, 5 ì°¸ê³ 

---

**ì‘ì„±ì¼**: 2025-12-29 14:23
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-29 14:45
**ê´€ë ¨ ë²”ìœ„**: tqqq, scripts, tests
**ê´€ë ¨ ë¬¸ì„œ**: src/qbt/tqqq/CLAUDE.md, scripts/CLAUDE.md, tests/CLAUDE.md

---

## 0) ê³ ì • ê·œì¹™ (ì´ planì€ ë°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ ë”°ë¥¸ë‹¤)

> ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«
> ì´ ì„¹ì…˜(0)ì€ ì§€ì›Œì§€ë©´ ì•ˆ ë  ë¿ë§Œ ì•„ë‹ˆë¼ **ë¬¸êµ¬ê°€ ìˆ˜ì •ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
> ê·œì¹™ì˜ ìƒì„¸ ì •ì˜/ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

- Validationì—ì„œ `poetry run ruff check .` ë˜ëŠ” `./run_tests.sh`ê°€ ì‹¤íŒ¨í•˜ë©´ **í•´ë‹¹ Phaseì—ì„œ ì¦‰ì‹œ ìˆ˜ì • í›„ ì¬ê²€ì¦**í•œë‹¤.
- Phase 0ì€ "ë ˆë“œ(ì˜ë„ì  ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸)" í—ˆìš©, Phase 1ë¶€í„°ëŠ” **ê·¸ë¦° ìœ ì§€**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- ì´ë¯¸ ìƒì„±ëœ planì€ **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™¸ ìˆ˜ì • ê¸ˆì§€**(ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ ìƒˆ plan ì‘ì„±).
- ìŠ¤í‚µì€ ê°€ëŠ¥í•˜ë©´ **Phase ë¶„í•´ë¡œ ì œê±°**í•œë‹¤.

---

## 1) ëª©í‘œ(Goal)

- [x] `_create_ffr_dict`ì™€ `validate_ffr_coverage`ë¥¼ í•­ìƒ ì„¸íŠ¸ë¡œ ì‹¤í–‰í•˜ë„ë¡ ê°•ì œ
- [x] FFR ê²€ì¦ì„ CLI ê³„ì¸µì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µìœ¼ë¡œ ì´ë™ (fail-fast ë³´ì¥)
- [x] ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í•¨ìˆ˜ê°€ `ffr_dict` ëŒ€ì‹  `ffr_df`ë¥¼ ë°›ë„ë¡ ë³€ê²½ (ìˆœìˆ˜ í•¨ìˆ˜ ìœ ì§€)
- [x] CLI ê³„ì¸µì€ ë°ì´í„° ë¡œë”©ë§Œ ë‹´ë‹¹, ê²€ì¦/ë³€í™˜ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‚´ë¶€ì—ì„œ ìë™ ì²˜ë¦¬
- [x] ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”: FFR ê²€ì¦/ë³€í™˜ì„ í•œ ë²ˆë§Œ ìˆ˜í–‰í•˜ê³  WORKER_CACHE í™œìš©

## 2) ë¹„ëª©í‘œ(Non-Goals)

- CSV íŒŒì¼ í˜•ì‹ ë³€ê²½ ë˜ëŠ” ì €ì¥ ê²½ë¡œ ë³€ê²½
- ì‹œë®¬ë ˆì´ì…˜ í•µì‹¬ ê³„ì‚° ë¡œì§ ë³€ê²½ (ë¹„ìš© ê³µì‹, ë ˆë²„ë¦¬ì§€ ë°°ìœ¨ ë“±)
- ìƒˆë¡œìš´ ê²€ì¦ ì •ì±… ì¶”ê°€ (ê¸°ì¡´ `MAX_FFR_MONTHS_DIFF` ì •ì±… ìœ ì§€)
- ê³µê°œ API ì „ë©´ ì¬ì„¤ê³„ (í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ ìµœì†Œí™”)

## 3) ë°°ê²½/ë§¥ë½(Context)

### í˜„ì¬ ë¬¸ì œì  / ë™ê¸°

**í˜„ì¬ êµ¬ì¡°ì˜ ë¬¸ì œ**:
1. CLI ê³„ì¸µì—ì„œ `_create_ffr_dict`ë§Œ í˜¸ì¶œí•˜ê³  `validate_ffr_coverage`ëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
2. FFR ì»¤ë²„ë¦¬ì§€ ê²€ì¦ ì—†ì´ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ â†’ ëŸ°íƒ€ì„ ì¤‘ ì‹¤íŒ¨ (ëŠ¦ì€ ì‹¤íŒ¨, late failure)
3. ê²€ì¦ì´ ì„ íƒì‚¬í•­ì²˜ëŸ¼ ë³´ì—¬ ì‚¬ìš©ìê°€ ê¹œë¹¡í•  ìœ„í—˜
4. fail-fast ì›ì¹™ ìœ„ë°˜ (ì‹œë®¬ë ˆì´ì…˜ ë„ì¤‘ ì˜ˆì™¸ ë°œìƒ)

**ë¬¸ì œ ë°œìƒ íë¦„**:
```python
# CLI ê³„ì¸µ (í˜„ì¬)
ffr_df = load_ffr_data(FFR_DATA_PATH)
ffr_dict = _create_ffr_dict(ffr_df)  # âŒ ê²€ì¦ ì—†ì´ ë”•ì…”ë„ˆë¦¬ ìƒì„±

# simulate() ë‚´ë¶€ì—ì„œ _lookup_ffr() í˜¸ì¶œ
# â†’ MAX_FFR_MONTHS_DIFF ì´ˆê³¼ ì‹œ ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ (ëŠ¦ì€ ì‹¤íŒ¨)
```

**í•´ê²° ë°©í–¥**:
- FFR ê²€ì¦ê³¼ ë”•ì…”ë„ˆë¦¬ ìƒì„±ì„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‚´ë¶€ë¡œ ì´ë™
- ë¹„ì¦ˆë‹ˆìŠ¤ í•¨ìˆ˜ê°€ `ffr_df`ë¥¼ ë°›ì•„ ë‚´ë¶€ì—ì„œ ê²€ì¦ â†’ ë³€í™˜ â†’ ì‚¬ìš©
- CLIëŠ” DataFrame ë¡œë”©ë§Œ ë‹´ë‹¹
- **ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”**: `find_optimal_cost_model`ì—ì„œ ê²€ì¦/ë³€í™˜ì„ í•œ ë²ˆë§Œ ìˆ˜í–‰ í›„ WORKER_CACHEì— `ffr_dict` ì €ì¥

### ì˜í–¥ë°›ëŠ” ê·œì¹™(ë°˜ë“œì‹œ ì½ê³  ì „ì²´ ìˆ™ì§€)

> ì•„ë˜ ë¬¸ì„œì— ê¸°ì¬ëœ ê·œì¹™ì„ **ëª¨ë‘ ìˆ™ì§€**í•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.

- `CLAUDE.md` (ë£¨íŠ¸): ê³„ì¸µ ë¶„ë¦¬, ìˆœìˆ˜ í•¨ìˆ˜, ë³‘ë ¬ ì²˜ë¦¬, ë°ì´í„° ë¶ˆë³€ì„± ì›ì¹™
- `src/qbt/tqqq/CLAUDE.md`: FFR ê²€ì¦ ì •ì±…, ë³‘ë ¬ ì²˜ë¦¬ WORKER_CACHE í™œìš© ê·œì¹™, ë¹„ìš© ëª¨ë¸ íŒŒë¼ë¯¸í„°
- `scripts/CLAUDE.md`: CLI ê³„ì¸µ ì±…ì„ (ë°ì´í„° ë¡œë”©, í•¨ìˆ˜ í˜¸ì¶œ, ê²°ê³¼ ì¶œë ¥)
- `tests/CLAUDE.md`: í…ŒìŠ¤íŠ¸ ì‘ì„± ê·œì¹™, í”½ìŠ¤ì²˜ ì‚¬ìš©
- `docs/CLAUDE.md`: ê³„íšì„œ ìš´ì˜ ê·œì¹™, Phase êµ¬ì„± ì›ì¹™

## 4) ì™„ë£Œ ì¡°ê±´(Definition of Done)

> Doneì€ "ì„œìˆ "ì´ ì•„ë‹ˆë¼ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ"ë¡œë§Œ íŒë‹¨í•©ë‹ˆë‹¤. (ì •ì˜/ì˜ˆì™¸ëŠ” docs/CLAUDE.md)

- [x] `simulate()` í•¨ìˆ˜ê°€ `ffr_df` íŒŒë¼ë¯¸í„°ë¥¼ ë°›ê³  ë‚´ë¶€ì—ì„œ ê²€ì¦+ë³€í™˜ ìˆ˜í–‰
- [x] `find_optimal_cost_model()` í•¨ìˆ˜ê°€ `ffr_df` íŒŒë¼ë¯¸í„°ë¥¼ ë°›ê³  ë‚´ë¶€ì—ì„œ ê²€ì¦+ë³€í™˜ ìˆ˜í–‰
- [x] `find_optimal_cost_model()` ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”: FFR ê²€ì¦/ë³€í™˜ í•œ ë²ˆë§Œ ìˆ˜í–‰
- [x] 3ê°œ CLI ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `_create_ffr_dict` í˜¸ì¶œ ì œê±° (ffr_dfë§Œ ì „ë‹¬)
- [x] ëª¨ë“  ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ìƒˆ ì‹œê·¸ë‹ˆì²˜ë¡œ ì—…ë°ì´íŠ¸ë˜ì–´ í†µê³¼
- [x] `./run_tests.sh` í†µê³¼ (failed=0, skipped=0; passed=143, failed=0, skipped=0)
- [x] `poetry run ruff check .` í†µê³¼
- [x] `poetry run black .` ì‹¤í–‰ ì™„ë£Œ (ë§ˆì§€ë§‰ Phaseì—ì„œ ìë™ í¬ë§· ì ìš©)
- [x] `src/qbt/tqqq/__init__.py`ì—ì„œ `_create_ffr_dict` ì œê±° (ë‚´ë¶€ í•¨ìˆ˜í™”)
- [x] `src/qbt/tqqq/CLAUDE.md` ì—…ë°ì´íŠ¸ (ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ ë°˜ì˜)
- [x] plan ì²´í¬ë°•ìŠ¤ ìµœì‹ í™”(Phase/DoD/Validation ëª¨ë‘ ë°˜ì˜)

## 5) ë³€ê²½ ë²”ìœ„(Scope)

### ë³€ê²½ ëŒ€ìƒ íŒŒì¼(ì˜ˆìƒ)

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (src/qbt/tqqq/)**:
- `simulation.py`: `simulate()`, `find_optimal_cost_model()` ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ ë° ë‚´ë¶€ ê²€ì¦ ë¡œì§ ì¶”ê°€
- `__init__.py`: ê³µê°œ APIì—ì„œ `_create_ffr_dict` ì œê±°

**CLI ìŠ¤í¬ë¦½íŠ¸ (scripts/tqqq/)**:
- `validate_tqqq_simulation.py`: `_create_ffr_dict` í˜¸ì¶œ ì œê±°, `ffr_df` ì „ë‹¬
- `generate_synthetic_tqqq.py`: `_create_ffr_dict` í˜¸ì¶œ ì œê±°, `ffr_df` ì „ë‹¬
- `generate_tqqq_daily_comparison.py`: `_create_ffr_dict` í˜¸ì¶œ ì œê±°, `ffr_df` ì „ë‹¬

**í…ŒìŠ¤íŠ¸ (tests/)**:
- `test_tqqq_simulation.py`: ëª¨ë“  í…ŒìŠ¤íŠ¸ì—ì„œ `ffr_dict` â†’ `ffr_df` íŒŒë¼ë¯¸í„° ë³€ê²½

**ë¬¸ì„œ (src/qbt/tqqq/)**:
- `CLAUDE.md`: ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ ë° ì‚¬ìš© ì˜ˆì‹œ ì—…ë°ì´íŠ¸

### ë°ì´í„°/ê²°ê³¼ ì˜í–¥

- **ì¶œë ¥ ìŠ¤í‚¤ë§ˆ**: ë³€ê²½ ì—†ìŒ (CSV í˜•ì‹ ë™ì¼)
- **ê³„ì‚° ê²°ê³¼**: ë³€ê²½ ì—†ìŒ (ë™ì¼í•œ FFR ê°’, ë™ì¼í•œ ê²€ì¦ ë¡œì§)
- **ê¸°ì¡´ ê²°ê³¼ ë¹„êµ**: ë¶ˆí•„ìš” (ë¡œì§ ë³€ê²½ ì—†ìŒ, êµ¬ì¡° ë³€ê²½ë§Œ)

## 6) ë‹¨ê³„ë³„ ê³„íš(Phases)

### Phase 1 â€” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜ì • (simulate í•¨ìˆ˜)

**ì‘ì—… ë‚´ìš©**:

- [ ] `simulation.py`ì˜ `simulate()` í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
  - íŒŒë¼ë¯¸í„°: `ffr_dict: dict[str, float]` â†’ `ffr_df: pd.DataFrame`
  - í•¨ìˆ˜ ì‹œì‘ ë¶€ë¶„ì— FFR ê²€ì¦ + ë³€í™˜ ì¶”ê°€:
    ```python
    # 1. FFR ì»¤ë²„ë¦¬ì§€ ê²€ì¦ (fail-fast)
    start_date = underlying_df[COL_DATE].min()
    end_date = underlying_df[COL_DATE].max()
    validate_ffr_coverage(start_date, end_date, ffr_df)

    # 2. ê²€ì¦ ì™„ë£Œ í›„ ë”•ì…”ë„ˆë¦¬ ìƒì„±
    ffr_dict = _create_ffr_dict(ffr_df)

    # 3. ë‚˜ë¨¸ì§€ ë¡œì§ì€ ê¸°ì¡´ ffr_dict ì‚¬ìš© (ë³€ê²½ ì—†ìŒ)
    ```
  - Docstring ì—…ë°ì´íŠ¸ (ffr_dict â†’ ffr_df íŒŒë¼ë¯¸í„° ì„¤ëª… ë³€ê²½)
  - "FFR ë°ì´í„° ì»¤ë²„ë¦¬ì§€ëŠ” í˜¸ì¶œ ì¸¡ì—ì„œ ì‚¬ì „ ê²€ì¦ë˜ì–´ì•¼ í•œë‹¤" â†’ "FFR ë°ì´í„° ì»¤ë²„ë¦¬ì§€ëŠ” í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìë™ ê²€ì¦ëœë‹¤"

**Validation**:

- [ ] `poetry run ruff check .`
- [ ] `./run_tests.sh` (passed=__, failed=__, skipped=__)

---

### Phase 2 â€” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜ì • (find_optimal_cost_model í•¨ìˆ˜ + ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”)

**ì‘ì—… ë‚´ìš©**:

- [ ] `simulation.py`ì˜ `find_optimal_cost_model()` í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
  - íŒŒë¼ë¯¸í„°: `ffr_dict: dict[str, float]` â†’ `ffr_df: pd.DataFrame`
  - ê²¹ì¹˜ëŠ” ê¸°ê°„ ì¶”ì¶œ í›„ FFR ê²€ì¦ + ë³€í™˜ ì¶”ê°€ (ë³‘ë ¬ ì²˜ë¦¬ ì „ í•œ ë²ˆë§Œ ìˆ˜í–‰):
    ```python
    # 1. ê²¹ì¹˜ëŠ” ê¸°ê°„ ì¶”ì¶œ
    underlying_overlap, actual_overlap = extract_overlap_period(...)

    # 2. FFR ì»¤ë²„ë¦¬ì§€ ê²€ì¦ (fail-fast)
    overlap_start = underlying_overlap[COL_DATE].min()
    overlap_end = underlying_overlap[COL_DATE].max()
    validate_ffr_coverage(overlap_start, overlap_end, ffr_df)

    # 3. ê²€ì¦ ì™„ë£Œ í›„ ë”•ì…”ë„ˆë¦¬ ìƒì„± (í•œ ë²ˆë§Œ)
    ffr_dict = _create_ffr_dict(ffr_df)

    # 4. WORKER_CACHEì— ffr_dict ì €ì¥ (ë³‘ë ¬ ì›Œì»¤ë“¤ì´ ì¬ì‚¬ìš©)
    candidates = execute_parallel(
        _evaluate_cost_model_candidate,
        param_combinations,
        max_workers=max_workers,
        initializer=init_worker_cache,
        initargs=(
            {
                "underlying_overlap": underlying_overlap,
                "actual_overlap": actual_overlap,
                "ffr_dict": ffr_dict,  # âœ… ì´ë¯¸ ê²€ì¦+ë³€í™˜ ì™„ë£Œëœ ë”•ì…”ë„ˆë¦¬
            },
        ),
    )
    ```
  - Docstring ì—…ë°ì´íŠ¸

- [ ] `_evaluate_cost_model_candidate()` í•¨ìˆ˜ëŠ” ë³€ê²½ ì—†ìŒ
  - WORKER_CACHEì—ì„œ `ffr_dict`ë¥¼ ì¡°íšŒí•˜ì—¬ ì‚¬ìš© (ê¸°ì¡´ ë¡œì§ ìœ ì§€)

**Validation**:

- [ ] `poetry run ruff check .`
- [ ] `./run_tests.sh` (passed=__, failed=__, skipped=__)

---

### Phase 3 â€” CLI ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •

**ì‘ì—… ë‚´ìš©**:

- [ ] `scripts/tqqq/validate_tqqq_simulation.py` ìˆ˜ì •
  - `_create_ffr_dict` import ì œê±°
  - `_create_ffr_dict(ffr_df)` í˜¸ì¶œ ì œê±° (79-81í–‰)
  - `find_optimal_cost_model(..., ffr_df=ffr_df, ...)`ë¡œ ë³€ê²½ (92-102í–‰)
  - ë¡œê·¸ ë©”ì‹œì§€ ì œê±°: "FFR ë”•ì…”ë„ˆë¦¬ ìƒì„± ì¤‘...", "FFR ë”•ì…”ë„ˆë¦¬ ìƒì„± ì™„ë£Œ" (79-81í–‰)

- [ ] `scripts/tqqq/generate_synthetic_tqqq.py` ìˆ˜ì •
  - `_create_ffr_dict` import ì œê±°
  - `_create_ffr_dict(ffr_df)` í˜¸ì¶œ ì œê±° (56-58í–‰)
  - `simulate(..., ffr_df=ffr_df, ...)`ë¡œ ë³€ê²½ (71-78í–‰)
  - ë¡œê·¸ ë©”ì‹œì§€ ì œê±°: "FFR ë”•ì…”ë„ˆë¦¬ ìƒì„± ì¤‘...", "FFR ë”•ì…”ë„ˆë¦¬ ìƒì„± ì™„ë£Œ" (56-58í–‰)

- [ ] `scripts/tqqq/generate_tqqq_daily_comparison.py` ìˆ˜ì •
  - `_create_ffr_dict` import ì œê±°
  - `_create_ffr_dict(ffr_df)` í˜¸ì¶œ ì œê±° (68-70í–‰)
  - `simulate(..., ffr_df=ffr_df, ...)`ë¡œ ë³€ê²½ (83-90í–‰)
  - ë¡œê·¸ ë©”ì‹œì§€ ì œê±°: "FFR ë”•ì…”ë„ˆë¦¬ ìƒì„± ì¤‘...", "FFR ë”•ì…”ë„ˆë¦¬ ìƒì„± ì™„ë£Œ" (68-70í–‰)

**Validation**:

- [ ] `poetry run ruff check .`
- [ ] `./run_tests.sh` (passed=__, failed=__, skipped=__)

---

### Phase 4 â€” í…ŒìŠ¤íŠ¸ ìˆ˜ì •

**ì‘ì—… ë‚´ìš©**:

- [ ] `tests/test_tqqq_simulation.py` ìˆ˜ì •
  - `_create_ffr_dict` ì§ì ‘ í˜¸ì¶œì„ ì œê±° (ë¹„ì¦ˆë‹ˆìŠ¤ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìë™ í˜¸ì¶œë¨)
  - ëª¨ë“  `simulate()` í˜¸ì¶œì„ `ffr_df` íŒŒë¼ë¯¸í„°ë¡œ ë³€ê²½:
    ```python
    # ë³€ê²½ ì „ (ì•½ 15ê°œ í…ŒìŠ¤íŠ¸)
    ffr_dict = _create_ffr_dict(ffr_df)
    simulate(..., ffr_dict=ffr_dict, ...)

    # ë³€ê²½ í›„
    simulate(..., ffr_df=ffr_df, ...)
    ```
  - ëª¨ë“  `find_optimal_cost_model()` í˜¸ì¶œì„ `ffr_df` íŒŒë¼ë¯¸í„°ë¡œ ë³€ê²½ (ì•½ 5ê°œ í…ŒìŠ¤íŠ¸)
  - `TestCreateFfrDict` í´ë˜ìŠ¤ëŠ” ìœ ì§€ (ë‚´ë¶€ í•¨ìˆ˜ì´ì§€ë§Œ ë¬´ê²°ì„± ê²€ì¦ í…ŒìŠ¤íŠ¸ í•„ìš”)
  - `TestValidateFfrCoverage` í´ë˜ìŠ¤ëŠ” ìœ ì§€ (ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ë¯€ë¡œ í…ŒìŠ¤íŠ¸ í•„ìš”)
  - `TestCalculateDailyCost` í´ë˜ìŠ¤ëŠ” ìœ ì§€ (ffr_dict ì‚¬ìš©í•˜ì§€ë§Œ ì§ì ‘ ìƒì„±)

**Validation**:

- [ ] `poetry run ruff check .`
- [ ] `./run_tests.sh` (passed=__, failed=__, skipped=__)

---

### Phase 5 â€” ê³µê°œ API ì •ë¦¬ ë° ë¬¸ì„œ ì—…ë°ì´íŠ¸

**ì‘ì—… ë‚´ìš©**:

- [ ] `src/qbt/tqqq/__init__.py` ìˆ˜ì •
  - `_create_ffr_dict` import ì œê±° (ë‚´ë¶€ í•¨ìˆ˜ë¡œë§Œ ì‚¬ìš©)
  - ê³µê°œ APIëŠ” `simulate`, `find_optimal_cost_model`, `calculate_validation_metrics`, `extract_overlap_period`ë§Œ ìœ ì§€

- [ ] `src/qbt/tqqq/CLAUDE.md` ì—…ë°ì´íŠ¸
  - "ì£¼ìš” í•¨ìˆ˜" ì„¹ì…˜:
    - `simulate()` ì‹œê·¸ë‹ˆì²˜: `ffr_dict` â†’ `ffr_df` ë³€ê²½
    - `find_optimal_cost_model()` ì‹œê·¸ë‹ˆì²˜: `ffr_dict` â†’ `ffr_df` ë³€ê²½
    - "FFR ì»¤ë²„ë¦¬ì§€ ê²€ì¦ì€ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìë™ ìˆ˜í–‰" ëª…ì‹œ
  - "ì‚¬ìš© ì˜ˆì‹œ" ì„¹ì…˜ (501-556í–‰):
    - ëª¨ë“  ì˜ˆì‹œì—ì„œ `ffr_dict` â†’ `ffr_df` ë³€ê²½
    - `_create_ffr_dict` í˜¸ì¶œ ì œê±°

**Validation**:

- [ ] `poetry run ruff check .`
- [ ] `./run_tests.sh` (passed=__, failed=__, skipped=__)

---

### Phase 6 â€” ìµœì¢… ê²€ì¦ ë° í¬ë§· ì ìš©

**ì‘ì—… ë‚´ìš©**:

- [ ] `poetry run black .` ì‹¤í–‰ (ìë™ í¬ë§· ì ìš©)

- [ ] ë³€ê²½ ê¸°ëŠ¥ ë° ì „ì²´ í”Œë¡œìš° ìµœì¢… ê²€ì¦
  - `poetry run python scripts/tqqq/validate_tqqq_simulation.py` ì‹¤í–‰ í™•ì¸
  - `poetry run python scripts/tqqq/generate_synthetic_tqqq.py` ì‹¤í–‰ í™•ì¸
  - `poetry run python scripts/tqqq/generate_tqqq_daily_comparison.py` ì‹¤í–‰ í™•ì¸
  - FFR ê°­ ì´ˆê³¼ ì‹œ ì˜ˆì™¸ ë°œìƒ í™•ì¸ (fail-fast ë™ì‘)

- [ ] DoD ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸ ë° ì²´í¬ ì™„ë£Œ
- [ ] ì „ì²´ Phase ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸ ë° ìƒíƒœ í™•ì •

**Validation**:

- [ ] `poetry run ruff check .`
- [ ] `./run_tests.sh` (passed=__, failed=__, skipped=__)

#### Commit Messages (Final candidates) â€” 5ê°œ ì¤‘ 1ê°œ ì„ íƒ

1. TQQQì‹œë®¬ë ˆì´ì…˜ / FFR ê²€ì¦ ë¡œì§ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì¸µ ì´ë™ (fail-fast ë³´ì¥)
2. TQQQì‹œë®¬ë ˆì´ì…˜ / FFR ë”•ì…”ë„ˆë¦¬ ìƒì„±/ê²€ì¦ ìë™í™” (CLI ë‹¨ìˆœí™”)
3. TQQQì‹œë®¬ë ˆì´ì…˜ / ë¹„ì¦ˆë‹ˆìŠ¤ í•¨ìˆ˜ê°€ ffr_df ì§ì ‘ ë°›ë„ë¡ ê°œì„  (ê²€ì¦ ê°•ì œí™”)
4. TQQQì‹œë®¬ë ˆì´ì…˜ / ê²€ì¦ ë¡œì§ ìº¡ìŠí™” ë° ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”
5. TQQQì‹œë®¬ë ˆì´ì…˜ / FFR ê²€ì¦ ê°•ì œí™” ë° ê³„ì¸µ ë¶„ë¦¬ ì›ì¹™ ì¤€ìˆ˜

## 7) ë¦¬ìŠ¤í¬(Risks)

**ë¦¬ìŠ¤í¬ 1: í…ŒìŠ¤íŠ¸ ëŒ€ëŸ‰ ìˆ˜ì •ìœ¼ë¡œ ì¸í•œ íšŒê·€**
- ì™„í™”: Phaseë³„ Validationì—ì„œ ì¦‰ì‹œ ê²€ì¦, ì „ì²´ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

**ë¦¬ìŠ¤í¬ 2: ê¸°ì¡´ ì‚¬ìš©ì ì½”ë“œ í˜¸í™˜ì„±**
- ì™„í™”: ê³µê°œ API ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ì´ì§€ë§Œ ë‚´ë¶€ ë¡œì§ ë™ì¼, ë¬¸ì„œì— ëª…í™•íˆ ê¸°ì¬

**ë¦¬ìŠ¤í¬ 3: FFR ê²€ì¦ ì¤‘ë³µ í˜¸ì¶œ ê°€ëŠ¥ì„±**
- ì™„í™”: `validate_ffr_coverage`ëŠ” ë¹„ìš©ì´ ë§¤ìš° ë‚®ìŒ (ë‹¨ìˆœ ë‚ ì§œ ë¹„êµ), ì„±ëŠ¥ ì˜í–¥ ë¯¸ë¯¸

**ë¦¬ìŠ¤í¬ 4: ë³‘ë ¬ ì²˜ë¦¬ ì„±ëŠ¥ ì˜í–¥**
- ì™„í™”: ì˜¤íˆë ¤ ê°œì„ ë¨ - ê²€ì¦/ë³€í™˜ì„ ë³‘ë ¬ ì „ í•œ ë²ˆë§Œ ìˆ˜í–‰, WORKER_CACHEë¡œ ffr_dict ì¬ì‚¬ìš©

## 8) ë©”ëª¨(Notes)

### í•µì‹¬ ê²°ì •ì‚¬í•­

1. **`_create_ffr_dict`ëŠ” ì—¬ì „íˆ private í•¨ìˆ˜ë¡œ ìœ ì§€**
   - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©
   - í…ŒìŠ¤íŠ¸ëŠ” ìœ ì§€ (ë¬´ê²°ì„± ê²€ì¦ ì¤‘ìš”)

2. **`validate_ffr_coverage`ëŠ” public í•¨ìˆ˜ë¡œ ìœ ì§€**
   - í–¥í›„ ì§ì ‘ í˜¸ì¶œ í•„ìš”í•  ìˆ˜ ìˆìŒ
   - í…ŒìŠ¤íŠ¸ì—ì„œë„ ëª…ì‹œì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸

3. **ê²€ì¦ ìˆœì„œ ê³ ì •: validate â†’ create â†’ use**
   - ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ í•¨ìˆ˜ì—ì„œ ë™ì¼í•œ íŒ¨í„´ ì‚¬ìš©

4. **ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™” ì „ëµ**
   - `find_optimal_cost_model()`: ê²€ì¦/ë³€í™˜ì„ ë³‘ë ¬ ì‹¤í–‰ ì „ í•œ ë²ˆë§Œ ìˆ˜í–‰
   - `simulate()`: í˜¸ì¶œë§ˆë‹¤ ê²€ì¦/ë³€í™˜ (ë‹¨ì¼ ì‹¤í–‰ì´ë¯€ë¡œ ë¬¸ì œ ì—†ìŒ)
   - WORKER_CACHEì— `ffr_dict` ì €ì¥í•˜ì—¬ ì›Œì»¤ë“¤ì´ ì¬ì‚¬ìš©

### ì§„í–‰ ë¡œê·¸ (KST)

- 2025-12-29 14:23: ê³„íšì„œ ì‘ì„± ì‹œì‘
- 2025-12-29 14:30: ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™” ì „ëµ ë°˜ì˜, Draft ìƒíƒœ
- 2025-12-29 14:30-14:35: Phase 1-2 ì™„ë£Œ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜ì •)
- 2025-12-29 14:35-14:37: Phase 3 ì™„ë£Œ (CLI ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •)
- 2025-12-29 14:37-14:41: Phase 4 ì™„ë£Œ (í…ŒìŠ¤íŠ¸ ìˆ˜ì •, 143 passed)
- 2025-12-29 14:41-14:43: Phase 5 ì™„ë£Œ (ê³µê°œ API ì •ë¦¬ ë° ë¬¸ì„œ ì—…ë°ì´íŠ¸)
- 2025-12-29 14:43-14:45: Phase 6 ì™„ë£Œ (ìµœì¢… ê²€ì¦, Black/Ruff í†µê³¼, 143 passed)
- 2025-12-29 14:45: ëª¨ë“  Phase ì™„ë£Œ, Done ìƒíƒœë¡œ ì „í™˜

---
