# Implementation Plan: import ì •ë¦¬ ë° signed ì˜¤ì°¨ ê³„ì‚° ë¡œì§ ì´ë™

> ì‘ì„±/ìš´ì˜ ê·œì¹™(SoT): ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
> (ì´ í…œí”Œë¦¿ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì–‘ì‹ì˜ ê³„íšì„œë¥¼ ë§Œë“¤ ë•Œë„ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ í¬ì¸í„°ë¡œ ë‘ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.)

**ìƒíƒœ**: âœ… Done

---

ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«

**ìƒíƒœ ì˜µì…˜**: ğŸŸ¡ Draft / ğŸ”„ In Progress / âœ… Done

**Done ì²˜ë¦¬ ê·œì¹™**:

- âœ… Done ì¡°ê±´: DoD ëª¨ë‘ [x] + `skipped=0` + `failed=0`
- âš ï¸ **ìŠ¤í‚µì´ 1ê°œë¼ë„ ì¡´ì¬í•˜ë©´ Done ì²˜ë¦¬ ê¸ˆì§€ + DoD í…ŒìŠ¤íŠ¸ í•­ëª© ì²´í¬ ê¸ˆì§€**
- ìƒì„¸: [docs/CLAUDE.md](../CLAUDE.md) ì„¹ì…˜ 3, 5 ì°¸ê³ 

---

**ì‘ì„±ì¼**: 2025-12-31 17:01
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-31 23:27
**ê´€ë ¨ ë²”ìœ„**: tqqq
**ê´€ë ¨ ë¬¸ì„œ**: src/qbt/tqqq/CLAUDE.md

---

## 0) ê³ ì • ê·œì¹™ (ì´ planì€ ë°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ ë”°ë¥¸ë‹¤)

> ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«
> ì´ ì„¹ì…˜(0)ì€ ì§€ì›Œì§€ë©´ ì•ˆ ë  ë¿ë§Œ ì•„ë‹ˆë¼ **ë¬¸êµ¬ê°€ ìˆ˜ì •ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
> ê·œì¹™ì˜ ìƒì„¸ ì •ì˜/ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

- Validationì—ì„œ `poetry run ruff check .` ë˜ëŠ” `./run_tests.sh`ê°€ ì‹¤íŒ¨í•˜ë©´ **í•´ë‹¹ Phaseì—ì„œ ì¦‰ì‹œ ìˆ˜ì • í›„ ì¬ê²€ì¦**í•œë‹¤.
- Phase 0ì€ "ë ˆë“œ(ì˜ë„ì  ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸)" í—ˆìš©, Phase 1ë¶€í„°ëŠ” **ê·¸ë¦° ìœ ì§€**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- ì´ë¯¸ ìƒì„±ëœ planì€ **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™¸ ìˆ˜ì • ê¸ˆì§€**í•œë‹¤.
- ìŠ¤í‚µì€ ê°€ëŠ¥í•˜ë©´ **Phase ë¶„í•´ë¡œ ì œê±°**í•œë‹¤.

---

## 1) ëª©í‘œ(Goal)

- [x] analysis_helpersì—ì„œ importí•˜ëŠ” í•¨ìˆ˜ë“¤ì„ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒë‹¨ìœ¼ë¡œ ì´ë™
- [x] `COL_CUMUL_MULTIPLE_LOG_DIFF_SIGNED` ìƒì„± ë¡œì§ì„ `_save_daily_comparison_csv`ì—ì„œ `calculate_validation_metrics`ë¡œ ì´ë™
- [x] ì½”ë“œ êµ¬ì¡° ê°œì„  (ì±…ì„ ë¶„ë¦¬: ê²€ì¦ ì§€í‘œëŠ” ê²€ì¦ í•¨ìˆ˜ì—ì„œ, ì €ì¥ì€ ì €ì¥ í•¨ìˆ˜ì—ì„œ)

## 2) ë¹„ëª©í‘œ(Non-Goals)

- ê¸°ëŠ¥ ë™ì‘ ë³€ê²½ (ë™ì‘ì€ ì™„ì „íˆ ë™ì¼í•˜ê²Œ ìœ ì§€)
- ìƒˆë¡œìš´ ê²€ì¦ ì§€í‘œ ì¶”ê°€
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€ (ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ëŠ”ì§€ë§Œ í™•ì¸)

## 3) ë°°ê²½/ë§¥ë½(Context)

### í˜„ì¬ ë¬¸ì œì  / ë™ê¸°

**ë¬¸ì œ 1: Import ìœ„ì¹˜**
- í˜„ì¬ `_save_daily_comparison_csv` í•¨ìˆ˜ ë‚´ë¶€(741-744ì¤„)ì—ì„œ `analysis_helpers`ë¥¼ importí•˜ê³  ìˆìŒ
- íŠ¹ë³„í•œ ìˆœí™˜ import ë¬¸ì œê°€ ì—†ìœ¼ë¯€ë¡œ ìƒë‹¨ìœ¼ë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ ì½”ë“œ êµ¬ì¡°ìƒ ë” ëª…í™•í•¨

**ë¬¸ì œ 2: ì±…ì„ ë¶„ë¦¬**
- `_save_daily_comparison_csv`ëŠ” "ì €ì¥"ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜ì¸ë°, "ê²€ì¦ ì§€í‘œ ê³„ì‚°" ë¡œì§ì´ í¬í•¨ë˜ì–´ ìˆìŒ
- `COL_CUMUL_MULTIPLE_LOG_DIFF_SIGNED` ìƒì„±ì€ ê²€ì¦ ì§€í‘œ ê³„ì‚°ì´ë¯€ë¡œ `calculate_validation_metrics`ì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì ì ˆí•¨
- í˜„ì¬ëŠ” abs ë²„ì „(`cumul_multiple_log_diff_series`)ë§Œ `calculate_validation_metrics`ì—ì„œ ê³„ì‚°í•˜ê³ , signed ë²„ì „ì€ ì €ì¥ í•¨ìˆ˜ì—ì„œ ê³„ì‚°í•˜ëŠ” ë¹„ëŒ€ì¹­ êµ¬ì¡°

### ì˜í–¥ë°›ëŠ” ê·œì¹™(ë°˜ë“œì‹œ ì½ê³  ì „ì²´ ìˆ™ì§€)

> ì•„ë˜ ë¬¸ì„œì— ê¸°ì¬ëœ ê·œì¹™ì„ **ëª¨ë‘ ìˆ™ì§€**í•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.

- `CLAUDE.md` (ë£¨íŠ¸)
- `src/qbt/tqqq/CLAUDE.md`
- `tests/CLAUDE.md`

## 4) ì™„ë£Œ ì¡°ê±´(Definition of Done)

> Doneì€ "ì„œìˆ "ì´ ì•„ë‹ˆë¼ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ"ë¡œë§Œ íŒë‹¨í•©ë‹ˆë‹¤. (ì •ì˜/ì˜ˆì™¸ëŠ” docs/CLAUDE.md)

- [x] importë¥¼ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ìƒë‹¨ìœ¼ë¡œ ì´ë™ ì™„ë£Œ
- [x] signed ì˜¤ì°¨ ê³„ì‚° ë¡œì§ì„ `calculate_validation_metrics`ë¡œ ì´ë™ ì™„ë£Œ
- [x] `_save_daily_comparison_csv` í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ì—…ë°ì´íŠ¸ (signed_log_diff íŒŒë¼ë¯¸í„° ì¶”ê°€)
- [x] `./run_tests.sh` í†µê³¼ (failed=0, skipped=0; passed=169, failed=0, skipped=0)
- [x] `poetry run ruff check .` í†µê³¼
- [x] `poetry run black .` ì‹¤í–‰ ì™„ë£Œ (ë§ˆì§€ë§‰ Phaseì—ì„œ ìë™ í¬ë§· ì ìš©)
- [x] plan ì²´í¬ë°•ìŠ¤ ìµœì‹ í™”(Phase/DoD/Validation ëª¨ë‘ ë°˜ì˜)

## 5) ë³€ê²½ ë²”ìœ„(Scope)

### ë³€ê²½ ëŒ€ìƒ íŒŒì¼(ì˜ˆìƒ)

- `src/qbt/tqqq/simulation.py`

### ë°ì´í„°/ê²°ê³¼ ì˜í–¥

- ì—†ìŒ (ë™ì‘ì€ ì™„ì „íˆ ë™ì¼, ë¦¬íŒ©í† ë§ë§Œ ìˆ˜í–‰)
- ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ëª¨ë‘ í†µê³¼í•´ì•¼ í•¨

## 6) ë‹¨ê³„ë³„ ê³„íš(Phases)

### Phase 1 â€” import ìƒë‹¨ ì´ë™

**ì‘ì—… ë‚´ìš©**:

- [x] `_save_daily_comparison_csv` í•¨ìˆ˜ ë‚´ë¶€(741-744ì¤„)ì˜ importë¥¼ ìƒë‹¨ import ì„¹ì…˜ìœ¼ë¡œ ì´ë™
  - `from qbt.tqqq.analysis_helpers import calculate_signed_log_diff_from_cumulative_returns, validate_integrity`
- [x] ì´ë™ í›„ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í•´ë‹¹ import ì œê±°
- [x] INTEGRITY_TOLERANCEë¥¼ constants importì— ì¶”ê°€

**Validation**:

- [x] `poetry run ruff check .`
- [x] `./run_tests.sh` (passed=169, failed=0, skipped=0)

---

### Phase 2 â€” signed ì˜¤ì°¨ ê³„ì‚° ë¡œì§ ì´ë™

**ì‘ì—… ë‚´ìš©**:

- [x] `calculate_validation_metrics` í•¨ìˆ˜ì—ì„œ signed ë¡œê·¸ì°¨ì´ ê³„ì‚° ì¶”ê°€
  - abs ë²„ì „ì„ ê³„ì‚°í•˜ëŠ” 832-836ì¤„ ë°”ë¡œ ë’¤ì— signed ë²„ì „ ê³„ì‚° ì¶”ê°€
  - `calculate_signed_log_diff_from_cumulative_returns` í•¨ìˆ˜ í˜¸ì¶œ
  - ëˆ„ì ìˆ˜ìµë¥  ì‹œê³„ì—´ ê³„ì‚° ì¶”ê°€
- [x] `_save_daily_comparison_csv` í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ìˆ˜ì •
  - `signed_log_diff_series: pd.Series` íŒŒë¼ë¯¸í„° ì¶”ê°€
  - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ signed ê³„ì‚° ë¡œì§ ì œê±°
  - ì „ë‹¬ë°›ì€ `signed_log_diff_series`ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- [x] `calculate_validation_metrics`ì—ì„œ `_save_daily_comparison_csv` í˜¸ì¶œ ì‹œ signed_log_diff_series ì „ë‹¬
- [x] í…ŒìŠ¤íŠ¸ ìˆ˜ì •: `_save_daily_comparison_csv` í˜¸ì¶œ ì‹œ signed_log_diff_series íŒŒë¼ë¯¸í„° ì¶”ê°€

**Validation**:

- [x] `poetry run ruff check .`
- [x] `./run_tests.sh` (passed=169, failed=0, skipped=0)

---

### Phase 3 â€” ë¬¸ì„œ ì •ë¦¬ ë° ìµœì¢… ê²€ì¦

**ì‘ì—… ë‚´ìš©**

- [x] `poetry run black .` ì‹¤í–‰(ìë™ í¬ë§· ì ìš©)
- [x] ë³€ê²½ ê¸°ëŠ¥ ë° ì „ì²´ í”Œë¡œìš° ìµœì¢… ê²€ì¦
- [x] DoD ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸ ë° ì²´í¬ ì™„ë£Œ
- [x] ì „ì²´ Phase ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸ ë° ìƒíƒœ í™•ì •

**Validation**:

- [x] `poetry run ruff check .`
- [x] `./run_tests.sh` (passed=169, failed=0, skipped=0)

#### Commit Messages (Final candidates) â€” 5ê°œ ì¤‘ 1ê°œ ì„ íƒ

1. TQQQì‹œë®¬ë ˆì´ì…˜ / import ì •ë¦¬ ë° signed ì˜¤ì°¨ ê³„ì‚° ì±…ì„ ë¶„ë¦¬
2. TQQQì‹œë®¬ë ˆì´ì…˜ / ê²€ì¦ ì§€í‘œ ê³„ì‚° ë¡œì§ ì´ë™ (ì €ì¥ í•¨ìˆ˜ì—ì„œ ê²€ì¦ í•¨ìˆ˜ë¡œ)
3. TQQQì‹œë®¬ë ˆì´ì…˜ / ë¦¬íŒ©í† ë§ (import ì •ë¦¬ + ì±…ì„ ë¶„ë¦¬, ë™ì‘ ë™ì¼)
4. TQQQì‹œë®¬ë ˆì´ì…˜ / ì½”ë“œ êµ¬ì¡° ê°œì„  (ê²€ì¦/ì €ì¥ ë¡œì§ ë¶„ë¦¬)
5. TQQQì‹œë®¬ë ˆì´ì…˜ / analysis_helpers import ìœ„ì¹˜ ìˆ˜ì • ë° signed ì˜¤ì°¨ ê³„ì‚° ì´ë™

## 7) ë¦¬ìŠ¤í¬(Risks)

- **ë¡œì§ ì´ë™ ì¤‘ ì‹¤ìˆ˜ ìœ„í—˜**: signed ì˜¤ì°¨ ê³„ì‚° ë¡œì§ì„ ì´ë™í•˜ë©´ì„œ ì‹¤ìˆ˜ë¡œ ë™ì‘ì´ ë°”ë€” ìˆ˜ ìˆìŒ
  - ì™„í™”ì±…: ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ëª¨ë‘ í†µê³¼í•˜ëŠ”ì§€ í™•ì¸ (ë™ì‘ ë™ì¼ì„± ë³´ì¥)
- **ë¬´ê²°ì„± ì²´í¬ ìœ„ì¹˜**: í˜„ì¬ëŠ” `_save_daily_comparison_csv`ì—ì„œ ìˆ˜í–‰í•˜ëŠ”ë°, ì´ë™ í›„ì—ë„ ë™ì¼í•œ ìœ„ì¹˜ì—ì„œ ìˆ˜í–‰í•´ì•¼ í•¨
  - ì™„í™”ì±…: ë¬´ê²°ì„± ì²´í¬ëŠ” ì €ì¥ í•¨ìˆ˜ì— ê·¸ëŒ€ë¡œ ìœ ì§€ (signed, abs ëª¨ë‘ ì „ë‹¬ë°›ì•„ì„œ ì²´í¬)

## 8) ë©”ëª¨(Notes)

- ì´ ì‘ì—…ì€ ìˆœìˆ˜ ë¦¬íŒ©í† ë§ì´ë¯€ë¡œ ë™ì‘ì€ ì™„ì „íˆ ë™ì¼í•´ì•¼ í•¨
- ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ëª¨ë‘ í†µê³¼í•˜ë©´ ì„±ê³µ

### ì§„í–‰ ë¡œê·¸ (KST)

- 2025-12-31 17:01: ê³„íšì„œ ì‘ì„± ì™„ë£Œ
- 2025-12-31 17:05: Phase 1 ì‹œì‘ - import ìƒë‹¨ ì´ë™
- 2025-12-31 17:10: Phase 1 ì™„ë£Œ (ruff check, tests passed)
- 2025-12-31 17:15: Phase 2 ì‹œì‘ - signed ì˜¤ì°¨ ê³„ì‚° ë¡œì§ ì´ë™
- 2025-12-31 17:25: Phase 2 ì™„ë£Œ (í…ŒìŠ¤íŠ¸ ìˆ˜ì • í¬í•¨, all tests passed)
- 2025-12-31 23:27: Phase 3 ì™„ë£Œ (black í¬ë§·íŒ…, ìµœì¢… ê²€ì¦) - ì „ì²´ ì‘ì—… ì™„ë£Œ

---
