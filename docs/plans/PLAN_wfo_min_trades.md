# Implementation Plan: WFO IS min_trades μ μ•½ μ¶”κ°€

> μ‘μ„±/μ΄μ κ·μΉ™(SoT): λ°λ“μ‹ [docs/CLAUDE.md](../CLAUDE.md)λ¥Ό μ°Έκ³ ν•μ„Έμ”.

**μƒνƒ**: β… Done

---

π« **μ΄ μμ—­μ€ μ‚­μ /μμ • κΈμ§€** π«

**μƒνƒ μµμ…**: π΅ Draft / π”„ In Progress / β… Done

**Done μ²λ¦¬ κ·μΉ™**:

- β… Done μ΅°κ±΄: DoD λ¨λ‘ [x] + `skipped=0` + `failed=0`
- β οΈ **μ¤ν‚µμ΄ 1κ°λΌλ„ μ΅΄μ¬ν•λ©΄ Done μ²λ¦¬ κΈμ§€ + DoD ν…μ¤νΈ ν•­λ© μ²΄ν¬ κΈμ§€**
- μƒμ„Έ: [docs/CLAUDE.md](../CLAUDE.md) μ„Ήμ… 3, 5 μ°Έκ³ 

---

**μ‘μ„±μΌ**: 2026-02-22 23:30
**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2026-02-23 00:00
**κ΄€λ ¨ λ²”μ„**: backtest (walkforward, constants)
**κ΄€λ ¨ λ¬Έμ„**: `src/qbt/backtest/CLAUDE.md`, `tests/CLAUDE.md`

---

## 0) κ³ μ • κ·μΉ™ (μ΄ planμ€ λ°λ“μ‹ μ•„λ κ·μΉ™μ„ λ”°λ¥Έλ‹¤)

> π« **μ΄ μμ—­μ€ μ‚­μ /μμ • κΈμ§€** π«
> μ΄ μ„Ήμ…(0)μ€ μ§€μ›μ§€λ©΄ μ• λ  λΏλ§ μ•„λ‹λΌ **λ¬Έκµ¬κ°€ μμ •λλ©΄ μ• λ©λ‹λ‹¤.**
> κ·μΉ™μ μƒμ„Έ μ •μ/μμ™Έλ” λ°λ“μ‹ [docs/CLAUDE.md](../CLAUDE.md)λ¥Ό λ”°λ¦…λ‹λ‹¤.

- `poetry run python validate_project.py`λ” **λ§μ§€λ§‰ Phaseμ—μ„λ§ μ‹¤ν–‰**ν•λ‹¤. μ‹¤ν¨ν•λ©΄ μ¦‰μ‹ μμ • ν›„ μ¬κ²€μ¦ν•λ‹¤.
- Phase 0μ€ "λ λ“(μλ„μ  μ‹¤ν¨ ν…μ¤νΈ)" ν—μ©, Phase 1λ¶€ν„°λ” **κ·Έλ¦° μ μ§€**λ¥Ό μ›μΉ™μΌλ΅ ν•λ‹¤.
- μ΄λ―Έ μƒμ„±λ planμ€ **μ²΄ν¬λ¦¬μ¤νΈ μ—…λ°μ΄νΈ μ™Έ μμ • κΈμ§€**ν•λ‹¤.
- μ¤ν‚µμ€ κ°€λ¥ν•λ©΄ **Phase λ¶„ν•΄λ΅ μ κ±°**ν•λ‹¤.

---

## 1) λ©ν‘(Goal)

- [x] `select_best_calmar_params()`μ— `min_trades` νλΌλ―Έν„° μ¶”κ°€ (κΈ°λ³Έκ°’: 3)
- [x] IS κ·Έλ¦¬λ“ μ„μΉμ—μ„ κ±°λμ λ¶€μ΅± νλΌλ―Έν„°λ¥Ό ν•„ν„°λ§ν•κ³ , νƒλ½ μ‹ λ΅κ·Έ μ¶λ ¥

## 2) λΉ„λ©ν‘(Non-Goals)

- OOS κ±°λμ κΈ°λ° μλ„μ° ν•„ν„°λ§ (OOSλ” μλ” κ·Έλ€λ΅ μ§‘κ³„)
- OOS ν”λκ·Έ μ»¬λΌ μ¶”κ°€ (λ¶ν•„μ”)
- ATR μ¤νƒ‘ λ„μ… (β†’ Plan 3μ—μ„ μν–‰)
- WFO μ¬μ‹¤ν–‰μΌλ΅ μ‚°μ¶λ¬Ό κ°±μ‹  (Plan κµ¬ν„ ν›„ λ³„λ„ μ‹¤ν–‰)

## 3) λ°°κ²½/λ§¥λ½(Context)

### ν„μ¬ λ¬Έμ μ  / λ™κΈ°

`select_best_calmar_params()`λ” κ±°λμ μ ν• μ—†μ΄ Calmarλ§μΌλ΅ μµμ  νλΌλ―Έν„°λ¥Ό μ„ νƒν•λ‹¤. IS κµ¬κ°„μ—μ„ κ±°λ 1~2νλ§ λ°μƒν• νλΌλ―Έν„°κ°€ μ°μ—°ν Calmar 1μ„λ¥Ό μ°¨μ§€ν•  μ μλ‹¤. μ΄λ” ν†µκ³„μ μΌλ΅ λ¬΄μλ―Έν• κ²°κ³Όλ¥Ό "μµμ "μΌλ΅ μ„ νƒν•λ” κµ¬μ΅°μ  κ²°ν•¨μ΄λ‹¤.

ν„μ¬ WFO λ°μ΄ν„° ν™•μΈ κ²°κ³Ό:
- IS κ±°λμ μµμ†κ°’: 3 (ν„μ¬λ” μν–¥ μ—†μ)
- ν•μ§€λ§ ATR μ¤νƒ‘ μ¶”κ°€(Plan 3) ν›„ νλΌλ―Έν„° κ·Έλ¦¬λ“ λ³€ν™”λ΅ IS κ±°λ 1~2ν νλΌλ―Έν„°κ°€ 1λ“±μ„ λ¨Ήλ” μƒν™©μ΄ λ°μƒ κ°€λ¥

λ”°λΌμ„ Plan 3 μ „μ— μ•μ „μ¥μΉλ΅ λ„μ…ν•λ‹¤.

### μν–¥λ°›λ” κ·μΉ™(λ°λ“μ‹ μ½κ³  μ „μ²΄ μ™μ§€)

> μ•„λ λ¬Έμ„μ— κΈ°μ¬λ κ·μΉ™μ„ **λ¨λ‘ μ™μ§€**ν•κ³  μ¤€μν•©λ‹λ‹¤.

- `src/qbt/backtest/CLAUDE.md`
- `tests/CLAUDE.md`

## 4) μ™„λ£ μ΅°κ±΄(Definition of Done)

> Doneμ€ "μ„μ "μ΄ μ•„λ‹λΌ "μ²΄ν¬λ¦¬μ¤νΈ μƒνƒ"λ΅λ§ νλ‹¨ν•©λ‹λ‹¤. (μ •μ/μμ™Έλ” docs/CLAUDE.md)

- [x] `select_best_calmar_params()`μ— `min_trades` νλΌλ―Έν„° μ¶”κ°€ (κΈ°λ³Έκ°’: 3)
- [x] κ±°λμ λ¶€μ΅± ν•„ν„°λ§ λ΅μ§ κµ¬ν„ (total_trades < min_tradesμΈ ν–‰ μ κ±°)
- [x] ν•„ν„°λ§μΌλ΅ μ›λ 1μ„κ°€ νƒλ½ν• κ²½μ° λ΅κ·Έ μ¶λ ¥
- [x] λ¨λ“  ν–‰μ΄ ν•„ν„°λ§λλ” κ²½μ° μμ™Έ μ²λ¦¬ (ValueError)
- [x] `DEFAULT_WFO_MIN_TRADES` μƒμ μ¶”κ°€ (`constants.py`)
- [x] νκ·€/μ‹ κ· ν…μ¤νΈ μ¶”κ°€
- [x] `poetry run python validate_project.py` ν†µκ³Ό (failed=0, skipped=0)
- [x] `poetry run black .` μ‹¤ν–‰ μ™„λ£ (λ§μ§€λ§‰ Phaseμ—μ„ μλ™ ν¬λ§· μ μ©)
- [x] plan μ²΄ν¬λ°•μ¤ μµμ‹ ν™”(Phase/DoD/Validation λ¨λ‘ λ°μ)

## 5) λ³€κ²½ λ²”μ„(Scope)

### λ³€κ²½ λ€μƒ νμΌ(μμƒ)

- `src/qbt/backtest/constants.py` β€” `DEFAULT_WFO_MIN_TRADES` μƒμ μ¶”κ°€
- `src/qbt/backtest/walkforward.py` β€” `select_best_calmar_params()` μμ •
- `tests/test_backtest_walkforward.py` β€” `TestCalmarSelection` ν΄λμ¤μ— min_trades ν…μ¤νΈ μ¶”κ°€

### λ°μ΄ν„°/κ²°κ³Ό μν–¥

- ν„μ¬ IS λ°μ΄ν„°μ—μ„ κ±°λμ μµμ†κ°’μ΄ 3μ΄λ―€λ΅, min_trades=3 μ μ© μ‹ **μ¦‰μ‹ κ²°κ³Ό λ³€ν™”λ” μ—†μ**
- Plan 3(ATR) μ΄ν›„ κ·Έλ¦¬λ“κ°€ λ‹¬λΌμ§€λ©΄ ν¨κ³Ό λ°μƒ κ°€λ¥
- κΈ°μ΅΄ CSV/JSON μ¶λ ¥ μ¤ν‚¤λ§ λ³€κ²½ μ—†μ

## 6) λ‹¨κ³„λ³„ κ³„ν(Phases)

### Phase 0 β€” min_trades μ •μ±… ν…μ¤νΈ μ„ ν–‰ μ‘μ„±(λ λ“)

**μ‘μ—… λ‚΄μ©**:

- [x] `constants.py`μ— `DEFAULT_WFO_MIN_TRADES: Final = 3` μ¶”κ°€
- [x] ν…μ¤νΈ μ¶”κ°€ (λ λ“):
  - `min_trades=3`μΌ λ• κ±°λμ 2μΈ νλΌλ―Έν„°κ°€ νƒλ½ν•κ³  2μ„κ°€ μ„ νƒλλ”μ§€ κ²€μ¦
  - `min_trades=0`μ΄λ©΄ κΈ°μ΅΄ λ™μ‘κ³Ό λ™μΌν•μ§€ κ²€μ¦ (ν•μ„ νΈν™)
  - λ¨λ“  ν–‰μ΄ min_trades λ―Έλ‹¬μΈ κ²½μ° ValueError λ°μƒ κ²€μ¦

---

### Phase 1 β€” ν•µμ‹¬ κµ¬ν„ + λ¬Έμ„ μ •λ¦¬ + μµμΆ… κ²€μ¦

**μ‘μ—… λ‚΄μ©**:

- [x] `select_best_calmar_params()` μμ •:
  - `min_trades: int = DEFAULT_WFO_MIN_TRADES` νλΌλ―Έν„° μ¶”κ°€
  - Calmar κ³„μ‚° μ „ `total_trades >= min_trades` ν•„ν„°λ§
  - ν•„ν„°λ§ μ „ 1μ„ vs ν•„ν„°λ§ ν›„ 1μ„κ°€ λ‹¤λ¥΄λ©΄ λ΅κ·Έ μ¶λ ¥:
    ```
    "min_trades={min_trades} ν•„ν„°: κΈ°μ΅΄ 1μ„(ma={}, trades={}) νƒλ½ β†’ μƒ 1μ„(ma={}, trades={})"
    ```
  - ν•„ν„°λ§ ν›„ ν›„λ³΄κ°€ 0μ΄λ©΄ ValueError λ°μƒ:
    ```
    "min_trades={min_trades} μ¶©μ΅± νλΌλ―Έν„° μ—†μ (μ „μ²΄ {n}κ° μ¤‘ 0κ° ν†µκ³Ό)"
    ```
- [x] Phase 0 λ λ“ ν…μ¤νΈ ν†µκ³Ό ν™•μΈ
- [x] `src/qbt/backtest/CLAUDE.md` μ—…λ°μ΄νΈ (min_trades μ„¤λ… μ¶”κ°€)
- [x] `poetry run black .` μ‹¤ν–‰(μλ™ ν¬λ§· μ μ©)
- [x] DoD μ²΄ν¬λ¦¬μ¤νΈ μµμΆ… μ—…λ°μ΄νΈ λ° μ²΄ν¬ μ™„λ£
- [x] μ „μ²΄ Phase μ²΄ν¬λ¦¬μ¤νΈ μµμΆ… μ—…λ°μ΄νΈ λ° μƒνƒ ν™•μ •

**Validation**:

- [x] `poetry run python validate_project.py` (passed=350, failed=0, skipped=0)

#### Commit Messages (Final candidates) β€” 5κ° μ¤‘ 1κ° μ„ νƒ

1. λ°±ν…μ¤νΈ / IS μµμ  νλΌλ―Έν„° μ„ νƒμ— min_trades μ μ•½ μ¶”κ°€
2. λ°±ν…μ¤νΈ / WFO Calmar μ„ νƒ μ‹ μµμ† κ±°λμ ν•„ν„°λ§ λ„μ…
3. λ°±ν…μ¤νΈ / κ±°λ λ¶€μ΅± νλΌλ―Έν„° νƒλ½ μ•μ „μ¥μΉ (min_trades=3)
4. λ°±ν…μ¤νΈ / select_best_calmar_paramsμ— min_trades ν•„ν„° μ¶”κ°€
5. λ°±ν…μ¤νΈ / WFO νλΌλ―Έν„° μ„ νƒ ν’μ§ ν–¥μƒ (min_trades μ μ•½)

## 7) λ¦¬μ¤ν¬(Risks)

- λ¨λ“  νλΌλ―Έν„°κ°€ min_trades λ―Έλ‹¬μΈ μλ„μ° λ°μƒ κ°€λ¥ β†’ ValueErrorλ΅ λ…μ‹μ  μ‹¤ν¨ μ²λ¦¬ (μ•”λ¬µμ  fallback κΈμ§€)
- κΈ°μ΅΄ `select_best_calmar_params()` νΈμ¶μ²(`run_walkforward`)κ°€ μƒ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•μ§€ μ•μ•„λ„ κΈ°λ³Έκ°’ 3μΌλ΅ λ™μ‘ (ν•μ„ νΈν™)

## 8) λ©”λ¨(Notes)

- μ°Έκ³ : `buffer_zone_tqqq_improvement_log.md` Session 14, 15μ ν•©μ λ‚΄μ©
- ν„μ¬ IS κ±°λμ μµμ†κ°’μ΄ 3μ΄λΌ μ¦‰μ‹ ν¨κ³Όλ” μ—†μ§€λ§, Plan 3(ATR) μ΄ν›„ μ•μ „μ¥μΉλ΅ μ‘λ™
- κµ¬ν„ λΉ„μ© λ§¤μ° λ‚®μ (μ΅°κ±΄λ¬Έ + λ΅κ·Έ μ¶”κ°€)

### μ§„ν–‰ λ΅κ·Έ (KST)

- 2026-02-22 23:30: Plan μ‘μ„± μ™„λ£ (Draft)
- 2026-02-23 00:00: Phase 0~1 κµ¬ν„ μ™„λ£, μ „μ²΄ κ²€μ¦ ν†µκ³Ό (passed=350, failed=0, skipped=0)

---
