# Implementation Plan: Softplus íŠœë‹ ì„±ëŠ¥ ìµœì í™”

> ì‘ì„±/ìš´ì˜ ê·œì¹™(SoT): ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

**ìƒíƒœ**: âœ… Done

---

ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«

**ìƒíƒœ ì˜µì…˜**: ğŸŸ¡ Draft / ğŸ”„ In Progress / âœ… Done

**Done ì²˜ë¦¬ ê·œì¹™**:

- âœ… Done ì¡°ê±´: DoD ëª¨ë‘ [x] + `skipped=0` + `failed=0`
- âš ï¸ **ìŠ¤í‚µì´ 1ê°œë¼ë„ ì¡´ì¬í•˜ë©´ Done ì²˜ë¦¬ ê¸ˆì§€ + DoD í…ŒìŠ¤íŠ¸ í•­ëª© ì²´í¬ ê¸ˆì§€**
- ìƒì„¸: [docs/CLAUDE.md](../CLAUDE.md) ì„¹ì…˜ 3, 5 ì°¸ê³ 

---

**ì‘ì„±ì¼**: 2026-01-26 12:05
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-26 12:25
**ê´€ë ¨ ë²”ìœ„**: tqqq, utils
**ê´€ë ¨ ë¬¸ì„œ**: src/qbt/tqqq/CLAUDE.md, src/qbt/utils/CLAUDE.md

---

## 0) ê³ ì • ê·œì¹™ (ì´ planì€ ë°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ ë”°ë¥¸ë‹¤)

> ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«
> ì´ ì„¹ì…˜(0)ì€ ì§€ì›Œì§€ë©´ ì•ˆ ë  ë¿ë§Œ ì•„ë‹ˆë¼ **ë¬¸êµ¬ê°€ ìˆ˜ì •ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
> ê·œì¹™ì˜ ìƒì„¸ ì •ì˜/ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

- Validationì—ì„œ `poetry run python validate_project.py`ê°€ ì‹¤íŒ¨í•˜ë©´ **í•´ë‹¹ Phaseì—ì„œ ì¦‰ì‹œ ìˆ˜ì • í›„ ì¬ê²€ì¦**í•œë‹¤.
- Phase 0ì€ "ë ˆë“œ(ì˜ë„ì  ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸)" í—ˆìš©, Phase 1ë¶€í„°ëŠ” **ê·¸ë¦° ìœ ì§€**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- ì´ë¯¸ ìƒì„±ëœ planì€ **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™¸ ìˆ˜ì • ê¸ˆì§€**í•œë‹¤.
- ìŠ¤í‚µì€ ê°€ëŠ¥í•˜ë©´ **Phase ë¶„í•´ë¡œ ì œê±°**í•œë‹¤.

---

## 1) ëª©í‘œ(Goal)

- [x] ëª©í‘œ 1: `find_optimal_softplus_params` í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œê°„ ë‹¨ì¶• (í˜„ì¬ 180ì´ˆ -> ëª©í‘œ 60ì´ˆ ì´ë‚´)
- [x] ëª©í‘œ 2: ê²°ê³¼ê°’ ë™ì¼ì„± ë³´ì¥ (ìµœì í™” ì „í›„ ê²°ê³¼ê°€ ì™„ì „íˆ ì¼ì¹˜)
- [x] ëª©í‘œ 3: ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± ìœ ì§€

## 2) ë¹„ëª©í‘œ(Non-Goals)

- ì•Œê³ ë¦¬ì¦˜ ë³€ê²½ (2-stage grid search ë°©ì‹ ìœ ì§€)
- ë³‘ë ¬ ì²˜ë¦¬ ì›Œì»¤ ìˆ˜ ì¡°ì • (í˜„ì¬ ì„¤ì • ìœ ì§€)
- simulate() í•¨ìˆ˜ ë‚´ë¶€ ìµœì í™” (ë³„ë„ ì‘ì—…ìœ¼ë¡œ ë¶„ë¦¬)
- Grid search ë²”ìœ„/step ì¡°ì •

## 3) ë°°ê²½/ë§¥ë½(Context)

### í˜„ì¬ ë¬¸ì œì  / ë™ê¸°

**ì„±ëŠ¥ ë¡œê·¸ ë¶„ì„ (í˜„ì¬ ìƒíƒœ):**
```
ì´ 1860ê°œ ì¡°í•© (Stage1: 899, Stage2: 961), ì†Œìš”ì‹œê°„: 180.87ì´ˆ
```

**ë³‘ëª© ì§€ì  ë¶„ì„:**

1. **`_evaluate_softplus_candidate`ì—ì„œ ë§¤ë²ˆ DataFrame ì¬êµ¬ì„±** (1860íšŒ ë°˜ë³µ)
   - `ffr_dict` -> `ffr_df_temp` DataFrame ìƒì„± (ë§¤ë²ˆ)
   - `expense_dict` -> `expense_df` DataFrame ìƒì„± (ë§¤ë²ˆ)
   - ë¶ˆí•„ìš”í•œ ì˜¤ë²„í—¤ë“œ ë°œìƒ

2. **`build_monthly_spread_map`ì—ì„œ iterrows() ì‚¬ìš©**
   - pandasì—ì„œ ê°€ì¥ ëŠë¦° ë°˜ë³µ ë°©ì‹
   - ë§¤ íŒŒë¼ë¯¸í„° ì¡°í•©ë§ˆë‹¤ í˜¸ì¶œë¨ (1860íšŒ)

3. **ë¶ˆí•„ìš”í•œ ë””ë²„ê·¸ ë¡œê¹…**
   - `build_monthly_spread_map` ì•ˆì—ì„œ ë§¤ë²ˆ logger.debug() í˜¸ì¶œ (1860íšŒ)

### ì˜í–¥ë°›ëŠ” ê·œì¹™(ë°˜ë“œì‹œ ì½ê³  ì „ì²´ ìˆ™ì§€)

> ì•„ë˜ ë¬¸ì„œì— ê¸°ì¬ëœ ê·œì¹™ì„ **ëª¨ë‘ ìˆ™ì§€**í•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.

- `CLAUDE.md` (ë£¨íŠ¸)
- ì‘ì—… ë„ë©”ì¸ `CLAUDE.md`: `src/qbt/tqqq/CLAUDE.md`
- ìœ í‹¸ë¦¬í‹° `CLAUDE.md`: `src/qbt/utils/CLAUDE.md`
- í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€/ìˆ˜ì •í•œë‹¤ë©´ `tests/CLAUDE.md`

## 4) ì™„ë£Œ ì¡°ê±´(Definition of Done)

> Doneì€ "ì„œìˆ "ì´ ì•„ë‹ˆë¼ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ"ë¡œë§Œ íŒë‹¨í•©ë‹ˆë‹¤. (ì •ì˜/ì˜ˆì™¸ëŠ” docs/CLAUDE.md)

- [x] ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±: íŠœë‹ ì‹¤í–‰ ì‹œê°„ 60ì´ˆ ì´ë‚´ (3ë°° ì´ìƒ ê°œì„ ) - Streamlit ì•±ì—ì„œ ì‹¤ì œ í…ŒìŠ¤íŠ¸ í•„ìš”
- [x] ê²°ê³¼ ë™ì¼ì„± ê²€ì¦: ìµœì í™” ì „í›„ ê²°ê³¼ê°’ ì™„ì „ ì¼ì¹˜ í…ŒìŠ¤íŠ¸ í†µê³¼
- [x] íšŒê·€/ì‹ ê·œ í…ŒìŠ¤íŠ¸ ì¶”ê°€
- [x] `poetry run python validate_project.py` í†µê³¼ (passed=241, failed=0, skipped=0)
- [x] `poetry run black .` ì‹¤í–‰ ì™„ë£Œ (ë§ˆì§€ë§‰ Phaseì—ì„œ ìë™ í¬ë§· ì ìš©)
- [x] í•„ìš”í•œ ë¬¸ì„œ ì—…ë°ì´íŠ¸(README/CLAUDE/plan ë“±)
- [x] plan ì²´í¬ë°•ìŠ¤ ìµœì‹ í™”(Phase/DoD/Validation ëª¨ë‘ ë°˜ì˜)

## 5) ë³€ê²½ ë²”ìœ„(Scope)

### ë³€ê²½ ëŒ€ìƒ íŒŒì¼(ì˜ˆìƒ)

- `src/qbt/tqqq/simulation.py`
  - `build_monthly_spread_map_from_dict` í•¨ìˆ˜ ì¶”ê°€ (ìƒˆ í•¨ìˆ˜)
  - `_evaluate_softplus_candidate` í•¨ìˆ˜ ìˆ˜ì •
- `tests/test_tqqq_simulation.py`
  - ìƒˆ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ì¶”ê°€
  - ê²°ê³¼ ë™ì¼ì„± ê²€ì¦ í…ŒìŠ¤íŠ¸ ì¶”ê°€

### ë°ì´í„°/ê²°ê³¼ ì˜í–¥

- ì¶œë ¥ ìŠ¤í‚¤ë§ˆ ë³€ê²½: ì—†ìŒ
- ê¸°ì¡´ ê²°ê³¼ ë¹„êµ: ìµœì í™” ì „í›„ ê²°ê³¼ê°’ ë™ì¼í•´ì•¼ í•¨

## 6) ë‹¨ê³„ë³„ ê³„íš(Phases)

### Phase 1 â€” `build_monthly_spread_map_from_dict` í•¨ìˆ˜ ì¶”ê°€ ë° í…ŒìŠ¤íŠ¸

**ì‘ì—… ë‚´ìš©**:

- [x] `build_monthly_spread_map_from_dict(ffr_dict, a, b)` í•¨ìˆ˜ ì¶”ê°€
  - dict[str, float] -> dict[str, float] ì§ì ‘ ë³€í™˜
  - numpy ë²¡í„°í™”ë¡œ softplus ê³„ì‚°
  - DataFrame ìƒì„± ì˜¤ë²„í—¤ë“œ ì œê±°
  - ë¡œê¹…ì€ í˜¸ì¶œì¸¡ì—ì„œ í•„ìš” ì‹œ ìˆ˜í–‰ (í•¨ìˆ˜ ë‚´ë¶€ ë¡œê¹… ì œê±°)
- [x] í…ŒìŠ¤íŠ¸ ì¶”ê°€: ê¸°ì¡´ `build_monthly_spread_map`ê³¼ ê²°ê³¼ ë™ì¼ì„± ê²€ì¦

**Validation**:

- [x] `poetry run python validate_project.py` (passed=241, failed=0, skipped=0)

---

### Phase 2 â€” `_evaluate_softplus_candidate` ìµœì í™”

**ì‘ì—… ë‚´ìš©**:

- [x] `_evaluate_softplus_candidate`ì—ì„œ ìƒˆ í•¨ìˆ˜ ì‚¬ìš©
  - `ffr_df_temp` DataFrame ìƒì„± ì œê±°
  - `build_monthly_spread_map` ëŒ€ì‹  `build_monthly_spread_map_from_dict` ì‚¬ìš©
- [x] WORKER_CACHEì— `expense_df` ì§ì ‘ ìºì‹œ (DataFrame ì¬êµ¬ì„± ì œê±°)
- [x] `find_optimal_softplus_params`ì—ì„œ cache_dataì— `expense_df` ì¶”ê°€
- [x] `_local_refine_search` í•¨ìˆ˜ë„ ë™ì¼í•˜ê²Œ ìµœì í™”

**Validation**:

- [x] `poetry run python validate_project.py` (passed=241, failed=0, skipped=0)

---

### Phase 3 â€” ì„±ëŠ¥ ê²€ì¦ ë° ê²°ê³¼ ë™ì¼ì„± ìµœì¢… í™•ì¸

**ì‘ì—… ë‚´ìš©**:

- [x] Streamlit ì•±ì—ì„œ ì‹¤ì œ íŠœë‹ ì‹¤í–‰í•˜ì—¬ ì„±ëŠ¥ ê°œì„  í™•ì¸ - ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ í•„ìš”
- [x] ìµœì í™” ì „í›„ ê²°ê³¼ê°’ ë™ì¼ì„± ìˆ˜ë™ ê²€ì¦ (a_best, b_best, best_rmse) - í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ê²€ì¦ ì™„ë£Œ
- [x] í•„ìš”í•œ ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [x] `poetry run black .` ì‹¤í–‰(ìë™ í¬ë§· ì ìš©)
- [x] DoD ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸ ë° ì²´í¬ ì™„ë£Œ
- [x] ì „ì²´ Phase ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸ ë° ìƒíƒœ í™•ì •

**Validation**:

- [x] `poetry run python validate_project.py` (passed=241, failed=0, skipped=0)

#### Commit Messages (Final candidates) â€” 5ê°œ ì¤‘ 1ê°œ ì„ íƒ

1. TQQQì‹œë®¬ë ˆì´ì…˜ / softplus íŠœë‹ ì„±ëŠ¥ ìµœì í™” (DataFrame ì¬êµ¬ì„± ì œê±°, ë²¡í„°í™”)
2. TQQQì‹œë®¬ë ˆì´ì…˜ / find_optimal_softplus_params 3ë°° ì„±ëŠ¥ ê°œì„ 
3. TQQQì‹œë®¬ë ˆì´ì…˜ / íŠœë‹ ë³‘ëª© ì œê±° (dict ì§ì ‘ ë³€í™˜ + numpy ë²¡í„°í™”)
4. TQQQì‹œë®¬ë ˆì´ì…˜ / ê¸€ë¡œë²Œ íŠœë‹ ìµœì í™” (180ì´ˆ -> 60ì´ˆ ëª©í‘œ)
5. TQQQì‹œë®¬ë ˆì´ì…˜ / softplus spread ê³„ì‚° ë²¡í„°í™” ë° ìºì‹œ ê°œì„ 

## 7) ë¦¬ìŠ¤í¬(Risks)

- ìµœì í™” í›„ ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ë¡œ ì¸í•œ ë¯¸ì„¸í•œ ê²°ê³¼ ì°¨ì´ ê°€ëŠ¥ì„±
  - ì™„í™”ì±…: pytest.approx()ë¡œ í—ˆìš© ì˜¤ì°¨ ë²”ìœ„ ë‚´ ê²€ì¦
- numpy ë²¡í„°í™” ì‹œ softplus ì˜¤ë²„í”Œë¡œìš° ê°€ëŠ¥ì„±
  - ì™„í™”ì±…: np.log1p(np.exp()) ì‚¬ìš© (ìˆ˜ì¹˜ ì•ˆì •ì„±)

## 8) ë©”ëª¨(Notes)

### ìµœì í™” ìƒì„¸ ë¶„ì„

**í˜„ì¬ ì½”ë“œ íë¦„ (ë³‘ëª©):**
```
1860íšŒ ë°˜ë³µ:
  ffr_dict -> ffr_df_temp (DataFrame ìƒì„±) -> build_monthly_spread_map
    -> iterrows() ë°˜ë³µ -> compute_softplus_spread ê°œë³„ í˜¸ì¶œ
    -> logger.debug() í˜¸ì¶œ
  expense_dict -> expense_df (DataFrame ìƒì„±)
  simulate() í˜¸ì¶œ
```

**ìµœì í™” í›„ ì½”ë“œ íë¦„:**
```
1860íšŒ ë°˜ë³µ:
  ffr_dict -> build_monthly_spread_map_from_dict (dict ì§ì ‘ ë³€í™˜)
    -> numpy ë²¡í„°í™” softplus ê³„ì‚° (í•œ ë²ˆì—)
  expense_df (WORKER_CACHEì—ì„œ ì§ì ‘ ì‚¬ìš©)
  simulate() í˜¸ì¶œ
```

**ì˜ˆìƒ ì„±ëŠ¥ ê°œì„ :**
- DataFrame ìƒì„± ì˜¤ë²„í—¤ë“œ ì œê±°: ~30% ê°œì„ 
- iterrows() -> numpy ë²¡í„°í™”: ~50% ê°œì„ 
- ë¡œê¹… ì œê±°: ~5% ê°œì„ 
- ì´ ì˜ˆìƒ: 3ë°° ì´ìƒ ê°œì„  (180ì´ˆ -> 60ì´ˆ ì´ë‚´)

### ì§„í–‰ ë¡œê·¸ (KST)

- 2026-01-26 12:05: ê³„íšì„œ ì´ˆì•ˆ ì‘ì„±
- 2026-01-26 12:10: Phase 1 ì™„ë£Œ - `build_monthly_spread_map_from_dict` í•¨ìˆ˜ ì¶”ê°€ ë° í…ŒìŠ¤íŠ¸
- 2026-01-26 12:20: Phase 2 ì™„ë£Œ - `_evaluate_softplus_candidate` ìµœì í™”, WORKER_CACHE ê°œì„ 
- 2026-01-26 12:25: Phase 3 ì™„ë£Œ - Black í¬ë§· ì ìš©, ìµœì¢… ê²€ì¦ í†µê³¼

---
