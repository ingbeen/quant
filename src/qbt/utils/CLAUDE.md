# 유틸리티 패키지 가이드

> 이 문서는 `src/qbt/utils/` 패키지에 대한 가이드입니다.
> 프로젝트 전반의 공통 규칙은 [루트 CLAUDE.md](../../../CLAUDE.md)를 참고하세요.

## 폴더 목적

유틸리티 패키지는 프로젝트 전반에서 공통으로 사용되는 횡단 관심사(cross-cutting concerns)를 제공합니다.

핵심 원칙: 도메인 로직과 독립적인 기술적 기능만 담당

---

## 모듈 구성

### 1. logger.py

프로젝트 전역 로거 생성 및 관리

- 레벨별 필터링, 포맷 표준화
- VSCode 통합을 위한 클릭 가능한 경로 (파일:줄번호 형식)

### 2. data_loader.py

중앙 집중식 CSV 로딩

- `load_stock_data`: 주식 데이터 로딩
- 자동 전처리: 파일 존재 확인, 필수 컬럼 검증, 날짜 파싱, 시간순 정렬, 중복 제거

### 3. cli_helpers.py

CLI 예외 처리 데코레이터

- `@cli_exception_handler`: 일관된 예외 처리 로직
- 스택 트레이스 자동 기록, 종료 코드 자동 반환 (성공 0, 실패 1)
- 로거 자동 감지

### 4. parallel_executor.py

병렬 처리 지원

- `execute_parallel`: 단일 인자 함수 병렬 실행
- `execute_parallel_with_kwargs`: 키워드 인자 함수 병렬 실행
- 입력 순서 보장된 결과 반환

### 5. formatting.py

터미널 출력 포맷팅

- 다국어 문자폭 계산 (한글 = 2칸, 영문 = 1칸)
- `TableLogger` 클래스: 컬럼 정의 기반 테이블 생성

### 6. meta_manager.py

실행 메타데이터 관리

- `save_metadata`: CSV 결과 파일의 생성 정보를 JSON으로 관리
- 순환 저장: 최근 N개만 유지 (`MAX_HISTORY_COUNT = 5`)
- ISO 8601 타임스탬프 자동 추가

---

## 설계 원칙

- 도메인 독립성: 특정 도메인 로직에 의존하지 않음
- 최소 의존성: 표준 라이브러리 우선 사용
- 명확한 책임: 각 모듈은 하나의 관심사만 담당
- 오류 투명성: 예외를 숨기거나 변환하지 않음

---

## 제약사항

### 병렬 처리 (Windows pickle 제약)

- 병렬 실행 함수는 pickle 가능해야 함 (람다 함수 불가)
- 모듈 레벨 함수 또는 클래스 메서드만 사용
- CLI 스크립트는 `if __name__ == "__main__"` 보호 필수
