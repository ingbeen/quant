# Spread 모델 대안 탐색 - 논의 요약

> 상태: 검토 중 (구현 전 논의 정리)
> 작성일: 2026-02-15

---

## 1. 현재 모델 (Softplus) 과적합 분석 결과

### 현재 모델

```
spread = softplus(a + b * FFR_pct)
최적 파라미터: a = -6.1, b = 0.37
```

### RMSE 비교

| 방식 | stitched RMSE | 설명 |
|------|-------------|------|
| 인샘플 (전체기간 최적화) | 1.0467% | 전체 데이터(2010~2025)로 (a,b) 찾고, 같은 데이터로 평가 |
| 고정 WF (a,b 완전 고정) | 1.3589% | 전체 데이터로 찾은 (a,b)를 워크포워드 테스트 구간에 적용 |
| 동적 WF (매달 재최적화) | 2.9167% | 60개월 훈련 → (a,b) 탐색 → 다음 1개월 테스트 |

### 핵심 발견

1. **인샘플 RMSE(1.05%)는 신뢰할 수 없다**
   - a=-6.1, b=0.37은 미래 데이터를 포함한 전체 기간으로 찾은 값
   - "답을 보고 푼 시험 점수"에 해당

2. **동적 WF(2.92%)가 softplus의 실제 예측 성능**
   - 과거 데이터만으로 (a,b)를 찾고, 안 본 다음 달에 테스트
   - "답 안 보고 푼 시험 점수"에 해당

3. **고정 WF(1.36%)와 인샘플(1.05%)의 비교는 공정하지 않다**
   - 측정 기간이 다름 (16년 vs 11년)
   - 고정 WF 테스트 구간이 파라미터 최적화 시 이미 포함된 데이터
   - 따라서 gap 0.31%p는 과적합의 하한선 (실제는 더 클 수 있음)

4. **결론: softplus 모델은 과적합 요소가 있다**
   - 인샘플 1.05% → 동적 WF 2.92% (약 1.87%p 열화)
   - 고정 파라미터가 동적보다 낫지만, "과적합이 없다"가 아니라 "과적합이 덜하다"

---

## 2. 과적합 검증 방법론 정리

### 올바른 과적합 판단 기준

- 과적합은 **절대 점수가 아니라 훈련-테스트 격차(gap)**로 판단
- 테스트 RMSE가 높아도 훈련 RMSE와 비슷하면 → 과적합 아님 (모델 한계)
- 테스트 RMSE만 높고 훈련 RMSE는 낮으면 → 과적합

### 현재 구현의 과적합 검증 흐름

```
대시보드: gap = fab_stitched - static_rmse
판정: gap < 0.5%p → 과적합 아님
      gap < 1.5%p → 약한 과적합
      gap > 1.5%p → 과적합 의심
```

### 한계점

- static_rmse(인샘플)와 fab_stitched(고정 WF)는 기간과 방법론이 달라 직접 비교 한계
- 진정한 과적합 검증은 **동적 WF vs 고정 WF** 비교가 더 적절

---

## 3. 대안 모델 후보

### 3-1. 모델링 자체를 바꾸는 방향

| 모델 | 아이디어 | 장단점 |
|------|---------|--------|
| **구간별 선형 (Piecewise Linear)** | 금리 구간마다 다른 기울기 적용 | 직관적, 단 경계점 선택이 자의적 |
| **다항식 (Polynomial)** | spread = a + b*FFR + c*FFR² | 비선형 포착, 단 외삽 시 발산 위험 |
| **레짐 전환 (Regime Switching)** | 저금리/고금리 시기를 나눠 각각 다른 모델 | 비정상성 직접 대응, 단 레짐 판단 기준 필요 |

### 3-2. 파라미터를 적응시키는 방향

| 모델 | 아이디어 | 장단점 |
|------|---------|--------|
| **지수 가중 (EWMA)** | 최근 데이터에 높은 가중치 | 간단, 단 가중치 선택이 또 하나의 파라미터 |
| **칼만 필터 (Kalman Filter)** | a, b를 시간에 따라 자동 업데이트 | 이론적으로 우아, 단 구현 복잡 |
| **확장 윈도우 (Expanding Window)** | 훈련 데이터를 점점 늘려감 | 간단, 단 오래된 데이터의 영향 잔존 |

### 3-3. 모델링을 포기하는 방향

| 방법 | 아이디어 | 장단점 |
|------|---------|--------|
| **실현 스프레드 직접 사용** | TQQQ 실제 수익률에서 스프레드를 역산해서 그대로 사용 | 가장 정확, 단 미래 예측 불가 (과거 검증용으로만) |
| **고정 스프레드** | 상수값 하나 사용 | 가장 단순, 단 금리 변동 무시 |

---

## 4. 우선 구현 대상: 룩업테이블 방식

### 접근법

```
1단계: 실현 스프레드 역산
   실제 TQQQ 수익률 - 이론적 3배 수익률 = 실제 비용
   실제 비용 - 운용비 - 금리*(레버리지-1) = 실현 스프레드

2단계: 금리 구간별 평균 스프레드 테이블 구축
   금리 0~1% → 평균 스프레드 X%
   금리 1~2% → 평균 스프레드 Y%
   ...

3단계: 워크포워드 검증
   훈련 60개월의 실현 스프레드로 테이블 구축 (과거만 사용)
   → 다음 1개월에 해당 금리 구간의 스프레드 적용
   → stitched RMSE 산출
```

### 과적합 검증 필요 여부

- 구간 폭, 통계량(평균/중앙값) 등을 **여러 개 시도해서 최적을 선택**할 예정
- 따라서 **워크포워드 과적합 검증 필요**

### 주의사항

- 금리 구간 중 관측이 적은 구간(예: 4~5%)은 통계적 신뢰도 낮음
- 훈련 60개월 안에 특정 금리 구간이 없으면 테이블 빈칸 발생

### softplus와의 비교 기준

```
                        stitched RMSE
softplus 동적 WF:         2.9167%
룩업테이블 WF:             ???%

??? < 2.92 → 룩업테이블이 더 나음 (softplus 모델 형태가 문제였음)
??? ≈ 2.92 → 금리→스프레드 예측 자체의 한계
??? > 2.92 → 데이터 부족으로 룩업테이블이 불안정
```
