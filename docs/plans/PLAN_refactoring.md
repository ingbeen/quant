# Implementation Plan: ì½”ë“œ ì¤‘ë³µ ì œê±° ë° ë¦¬íŒ©í† ë§

> ì‘ì„±/ìš´ì˜ ê·œì¹™(SoT): ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
> (ì´ í…œí”Œë¦¿ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì–‘ì‹ì˜ ê³„íšì„œë¥¼ ë§Œë“¤ ë•Œë„ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ í¬ì¸í„°ë¡œ ë‘ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.)

**ìƒíƒœ**: ğŸŸ¡ Draft

---

ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«

**ìƒíƒœ ì˜µì…˜**: ğŸŸ¡ Draft / ğŸ”„ In Progress / âœ… Done

**Done ì²˜ë¦¬ ê·œì¹™**:

- âœ… Done ì¡°ê±´: DoD ëª¨ë‘ [x] + `skipped=0` + `failed=0`
- âš ï¸ **ìŠ¤í‚µì´ 1ê°œë¼ë„ ì¡´ì¬í•˜ë©´ Done ì²˜ë¦¬ ê¸ˆì§€ + DoD í…ŒìŠ¤íŠ¸ í•­ëª© ì²´í¬ ê¸ˆì§€**
- ìƒì„¸: [docs/CLAUDE.md](../CLAUDE.md) ì„¹ì…˜ 3, 5 ì°¸ê³ 

---

**ì‘ì„±ì¼**: 2026-02-20 20:00
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-20 20:00
**ê´€ë ¨ ë²”ìœ„**: src/qbt/tqqq, src/qbt/backtest, scripts/tqqq
**ê´€ë ¨ ë¬¸ì„œ**: `src/qbt/tqqq/CLAUDE.md`, `src/qbt/backtest/CLAUDE.md`, `tests/CLAUDE.md`

---

## 0) ê³ ì • ê·œì¹™ (ì´ planì€ ë°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ ë”°ë¥¸ë‹¤)

> ğŸš« **ì´ ì˜ì—­ì€ ì‚­ì œ/ìˆ˜ì • ê¸ˆì§€** ğŸš«
> ì´ ì„¹ì…˜(0)ì€ ì§€ì›Œì§€ë©´ ì•ˆ ë  ë¿ë§Œ ì•„ë‹ˆë¼ **ë¬¸êµ¬ê°€ ìˆ˜ì •ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
> ê·œì¹™ì˜ ìƒì„¸ ì •ì˜/ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

- `poetry run python validate_project.py`ëŠ” **ë§ˆì§€ë§‰ Phaseì—ì„œë§Œ ì‹¤í–‰**í•œë‹¤. ì‹¤íŒ¨í•˜ë©´ ì¦‰ì‹œ ìˆ˜ì • í›„ ì¬ê²€ì¦í•œë‹¤.
- Phase 0ì€ "ë ˆë“œ(ì˜ë„ì  ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸)" í—ˆìš©, Phase 1ë¶€í„°ëŠ” **ê·¸ë¦° ìœ ì§€**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- ì´ë¯¸ ìƒì„±ëœ planì€ **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™¸ ìˆ˜ì • ê¸ˆì§€**í•œë‹¤.
- ìŠ¤í‚µì€ ê°€ëŠ¥í•˜ë©´ **Phase ë¶„í•´ë¡œ ì œê±°**í•œë‹¤.

---

## 1) ëª©í‘œ(Goal)

- [ ] ëª©í‘œ 1: `_prepare_monthly_data` í•¨ìˆ˜ ì¤‘ë³µ ì œê±° (ë³´ê³ ì„œ D-1)
- [ ] ëª©í‘œ 2: `simulation.py` ë‚´ë¶€ ì´ˆê¸°í™” ì½”ë“œ ì¤‘ë³µ ì œê±° (ë³´ê³ ì„œ D-6)
- [ ] ëª©í‘œ 3: `simulation.py` ë‚´ë¶€ stitched RMSE í•¨ìˆ˜ ì¤‘ë³µ ì œê±° (ë³´ê³ ì„œ D-7)
- [ ] ëª©í‘œ 4: `buy_and_hold.py`ì˜ `iterrows()` ë²¡í„°í™” (ë³´ê³ ì„œ D-9)
- [ ] ëª©í‘œ 5: `aggregate_monthly`ì˜ `sum_daily_m` placeholder ì£¼ì„ ë³´ê°• (ë³´ê³ ì„œ E-4)

## 2) ë¹„ëª©í‘œ(Non-Goals)

- `simulation.py` íŒŒì¼ ë¶„í•  (D-4): 2108ì¤„ íŒŒì¼ì˜ ëª¨ë“ˆ ë¶„í• ì€ ë³„ë„ ê³„íšì„œ ëŒ€ìƒ
- `app_rate_spread_lab.py` íŒŒì¼ ë¶„í•  (D-5): 1762ì¤„ íŒŒì¼ì˜ ëª¨ë“ˆ ë¶„í• ì€ ë³„ë„ ê³„íšì„œ ëŒ€ìƒ
- 3ê°œ ì›Œí¬í¬ì›Œë“œ ìŠ¤í¬ë¦½íŠ¸ í†µí•© (D-3): CLI ê³„ì¸µ êµ¬ì¡° ë³€ê²½ìœ¼ë¡œ ë³„ë„ ê³„íšì„œ ëŒ€ìƒ
- CLI ê³„ì¸µ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬ (C-1~3): ëŒ€ê·œëª¨ êµ¬ì¡° ë³€ê²½ìœ¼ë¡œ ë³„ë„ ê³„íšì„œ ëŒ€ìƒ
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½: ëª¨ë“  ë¦¬íŒ©í† ë§ì€ ë™ì‘ ë™ì¼ì„±(behavioral equivalence) ë³´ì¥

## 3) ë°°ê²½/ë§¥ë½(Context)

### í˜„ì¬ ë¬¸ì œì  / ë™ê¸°

- D-1: `_prepare_monthly_data()` í•¨ìˆ˜ê°€ `generate_rate_spread_lab.py`ì™€ `app_rate_spread_lab.py`ì— ì™„ì „íˆ ë™ì¼í•˜ê²Œ ë³µì‚¬ë¨. í•œìª½ ìˆ˜ì • ì‹œ ë‹¤ë¥¸ ìª½ì´ ë™ê¸°í™”ë˜ì§€ ì•ŠëŠ” ìœ„í—˜
- D-6: `find_optimal_softplus_params`ì™€ `_local_refine_search`ì—ì„œ ê²¹ì¹˜ëŠ” ê¸°ê°„ ì¶”ì¶œ, FFR ê²€ì¦, ë”•ì…”ë„ˆë¦¬ ìƒì„± ë“± ~40ì¤„ì˜ ì´ˆê¸°í™” ì½”ë“œê°€ ì¤‘ë³µ
- D-7: `calculate_stitched_walkforward_rmse`ì™€ `calculate_fixed_ab_stitched_rmse`ê°€ spread_map ìƒì„± ë°©ì‹ë§Œ ë‹¤ë¥´ê³  ë‚˜ë¨¸ì§€ ~60ì¤„ì´ ë™ì¼
- D-9: `buy_and_hold.py`ì—ì„œ `iterrows()` ì‚¬ìš© â€” pandas ë²¡í„°í™”ë¡œ ëŒ€ì²´í•˜ë©´ ì„±ëŠ¥ ê°œì„ 
- E-4: `aggregate_monthly`ì—ì„œ `sum_daily_m`ì„ í•­ìƒ NAë¡œ ì„¤ì •í•˜ì§€ë§Œ í˜¸ì¶œì ê°€ì´ë“œê°€ ë¶ˆì¶©ë¶„

### ì˜í–¥ë°›ëŠ” ê·œì¹™(ë°˜ë“œì‹œ ì½ê³  ì „ì²´ ìˆ™ì§€)

> ì•„ë˜ ë¬¸ì„œì— ê¸°ì¬ëœ ê·œì¹™ì„ **ëª¨ë‘ ìˆ™ì§€**í•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.

- `CLAUDE.md`(ë£¨íŠ¸): ë°ì´í„° ë¶ˆë³€ì„±, ìƒíƒœ ë¹„ì €ì¥ ì›ì¹™
- `src/qbt/tqqq/CLAUDE.md`: ì‹œë®¬ë ˆì´ì…˜ ì—”ì§„, ë¶„ì„ í•¨ìˆ˜ ëª©ë¡
- `src/qbt/backtest/CLAUDE.md`: Buy & Hold ì „ëµ ê·œì¹™
- `tests/CLAUDE.md`: í…ŒìŠ¤íŠ¸ ì‘ì„± ì›ì¹™

## 4) ì™„ë£Œ ì¡°ê±´(Definition of Done)

> Doneì€ "ì„œìˆ "ì´ ì•„ë‹ˆë¼ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ"ë¡œë§Œ íŒë‹¨í•©ë‹ˆë‹¤. (ì •ì˜/ì˜ˆì™¸ëŠ” docs/CLAUDE.md)

- [ ] D-1: `_prepare_monthly_data`ê°€ `analysis_helpers.py`ì— 1ê³³ë§Œ ì¡´ì¬
- [ ] D-6: `simulation.py` ì´ˆê¸°í™” ì½”ë“œê°€ í—¬í¼ í•¨ìˆ˜ë¡œ ì¶”ì¶œë˜ì–´ ì¤‘ë³µ ì œê±°
- [ ] D-7: stitched RMSE ê³µí†µ ë¡œì§ì´ í—¬í¼ í•¨ìˆ˜ë¡œ ì¶”ì¶œë˜ì–´ ì¤‘ë³µ ì œê±°
- [ ] D-9: `buy_and_hold.py`ì—ì„œ `iterrows()` ì œê±°, ë²¡í„°í™” ì—°ì‚°ìœ¼ë¡œ ëŒ€ì²´
- [ ] E-4: `aggregate_monthly` docstringì— `sum_daily_m` ì‚¬ìš© ê°€ì´ë“œ ì¶”ê°€
- [ ] ê° ìˆ˜ì •ì— ëŒ€í•œ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
- [ ] `poetry run python validate_project.py` í†µê³¼ (failed=0, skipped=0)
- [ ] `poetry run black .` ì‹¤í–‰ ì™„ë£Œ
- [ ] plan ì²´í¬ë°•ìŠ¤ ìµœì‹ í™”

## 5) ë³€ê²½ ë²”ìœ„(Scope)

### ë³€ê²½ ëŒ€ìƒ íŒŒì¼(ì˜ˆìƒ)

**D-1 (`_prepare_monthly_data` ì¶”ì¶œ)**:
- `src/qbt/tqqq/analysis_helpers.py` â€” í•¨ìˆ˜ ì¶”ê°€
- `scripts/tqqq/spread_lab/generate_rate_spread_lab.py` â€” ë¡œì»¬ í•¨ìˆ˜ ì œê±°, importë¡œ ë³€ê²½
- `scripts/tqqq/spread_lab/app_rate_spread_lab.py` â€” ë¡œì»¬ í•¨ìˆ˜ ì œê±°, importë¡œ ë³€ê²½

**D-6 (ì´ˆê¸°í™” ì½”ë“œ í—¬í¼ ì¶”ì¶œ)**:
- `src/qbt/tqqq/simulation.py` â€” ê³µí†µ ì´ˆê¸°í™” í—¬í¼ í•¨ìˆ˜ ì¶”ê°€, ê¸°ì¡´ í•¨ìˆ˜ì—ì„œ í˜¸ì¶œ

**D-7 (stitched RMSE í—¬í¼ ì¶”ì¶œ)**:
- `src/qbt/tqqq/simulation.py` â€” ê³µí†µ stitched ì‹œë®¬ë ˆì´ì…˜ í—¬í¼ ì¶”ì¶œ, ê¸°ì¡´ 2ê°œ í•¨ìˆ˜ì—ì„œ í˜¸ì¶œ

**D-9 (iterrows ë²¡í„°í™”)**:
- `src/qbt/backtest/strategies/buy_and_hold.py` â€” `run_buy_and_hold` í•¨ìˆ˜ ë‚´ë¶€ ë²¡í„°í™”

**E-4 (ì£¼ì„ ë³´ê°•)**:
- `src/qbt/tqqq/analysis_helpers.py` â€” `aggregate_monthly` docstring ë³´ê°•

### ë°ì´í„°/ê²°ê³¼ ì˜í–¥

- ëª¨ë“  ë³€ê²½ì€ ë™ì‘ ë™ì¼ì„± ë³´ì¥. ì¶œë ¥ CSV/JSON ë‚´ìš© ë³€ê²½ ì—†ìŒ
- D-9: ë¶€ë™ì†Œìˆ˜ì  ì—°ì‚° ìˆœì„œ ì°¨ì´ë¡œ ê·¹ë¯¸í•œ ì°¨ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ë°˜ì˜¬ë¦¼ ê·œì¹™ ì ìš© í›„ ë™ì¼

## 6) ë‹¨ê³„ë³„ ê³„íš(Phases)

### Phase 1 â€” `_prepare_monthly_data` ì¶”ì¶œ ë° `buy_and_hold` ë²¡í„°í™” (ê·¸ë¦° ìœ ì§€)

**ì‘ì—… ë‚´ìš©**:

- [ ] D-1: `_prepare_monthly_data` í•¨ìˆ˜ë¥¼ `src/qbt/tqqq/analysis_helpers.py`ë¡œ ì´ë™
  - í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ìœ ì§€, docstring ì¶”ê°€
  - `generate_rate_spread_lab.py`ì—ì„œ ë¡œì»¬ í•¨ìˆ˜ ì œê±°, importë¡œ ëŒ€ì²´
  - `app_rate_spread_lab.py`ì—ì„œ ë¡œì»¬ í•¨ìˆ˜ ì œê±°, importë¡œ ëŒ€ì²´
- [ ] D-9: `buy_and_hold.py`ì˜ `run_buy_and_hold` í•¨ìˆ˜ë¥¼ ë²¡í„°í™”
  - `for _, row in trade_df.iterrows()` ë£¨í”„ â†’ `trade_df[COL_CLOSE]` ë²¡í„° ì—°ì‚°
  - ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

---

### Phase 2 â€” `simulation.py` ë‚´ë¶€ ì¤‘ë³µ ì œê±° (ê·¸ë¦° ìœ ì§€)

**ì‘ì—… ë‚´ìš©**:

- [ ] D-6: ê³µí†µ ì´ˆê¸°í™” í—¬í¼ í•¨ìˆ˜ ì¶”ì¶œ (ì˜ˆ: `_prepare_optimization_data`)
  - overlap ì¶”ì¶œ, FFR ê²€ì¦, ë”•ì…”ë„ˆë¦¬ ìƒì„±, numpy ë°°ì—´ ë³€í™˜ ë¡œì§ì„ í¬í•¨
  - `find_optimal_softplus_params`ì™€ `_local_refine_search`ì—ì„œ í˜¸ì¶œ
- [ ] D-7: ê³µí†µ stitched ì‹œë®¬ë ˆì´ì…˜ í—¬í¼ í•¨ìˆ˜ ì¶”ì¶œ (ì˜ˆ: `_simulate_stitched_periods`)
  - overlap ì¶”ì¶œ, ì›” ì»¬ëŸ¼ ìƒì„±, ê¸°ê°„ í•„í„°ë§, simulate í˜¸ì¶œ ë¡œì§ì„ í¬í•¨
  - `calculate_stitched_walkforward_rmse`ì™€ `calculate_fixed_ab_stitched_rmse`ì—ì„œ í˜¸ì¶œ
  - spread_map ìƒì„±ì€ ê° í•¨ìˆ˜ì—ì„œ ê°œë³„ ì²˜ë¦¬ (ì°¨ì´ì )
- [ ] E-4: `aggregate_monthly` docstringì— `sum_daily_m` placeholder ì„¤ëª… ì¶”ê°€
  - í˜¸ì¶œìê°€ `calculate_daily_signed_log_diff` í›„ ë³„ë„ ê³„ì‚°í•´ì•¼ í•¨ì„ ëª…ì‹œ

---

### Phase 3 (ë§ˆì§€ë§‰) â€” ë¬¸ì„œ ì •ë¦¬ ë° ìµœì¢… ê²€ì¦

**ì‘ì—… ë‚´ìš©**:

- [ ] `src/qbt/tqqq/CLAUDE.md`ì— ìƒˆë¡œ ì¶”ì¶œëœ í•¨ìˆ˜ ë°˜ì˜
- [ ] `poetry run black .` ì‹¤í–‰
- [ ] DoD ì²´í¬ë¦¬ìŠ¤íŠ¸ ìµœì¢… ì—…ë°ì´íŠ¸

**Validation**:

- [ ] `poetry run python validate_project.py` (passed=__, failed=__, skipped=__)

#### Commit Messages (Final candidates) â€” 5ê°œ ì¤‘ 1ê°œ ì„ íƒ

1. TQQQì‹œë®¬ë ˆì´ì…˜ / ì½”ë“œ ì¤‘ë³µ ì œê±° ë° í•¨ìˆ˜ ì¶”ì¶œ ë¦¬íŒ©í† ë§ (ë™ì‘ ë™ì¼)
2. í”„ë¡œì íŠ¸ / D-1, D-6, D-7, D-9 ì½”ë“œ ì¤‘ë³µ ì œê±° + iterrows ë²¡í„°í™”
3. TQQQì‹œë®¬ë ˆì´ì…˜ / _prepare_monthly_data ì¶”ì¶œ + simulation.py ë‚´ë¶€ ì¤‘ë³µ í•´ì†Œ
4. í”„ë¡œì íŠ¸ / ë¦¬íŒ©í† ë§ â€” í•¨ìˆ˜ ì¶”ì¶œë¡œ ì½”ë“œ ì¤‘ë³µ ì œê±° (ë™ì‘ ë¬´ë³€ê²½)
5. ë°±í…ŒìŠ¤íŠ¸ / buy_and_hold ë²¡í„°í™” + TQQQ simulation ì¤‘ë³µ ì½”ë“œ ì •ë¦¬

## 7) ë¦¬ìŠ¤í¬(Risks)

- D-1: í•¨ìˆ˜ ì´ë™ ì‹œ import ê²½ë¡œ ë³€ê²½. ê¸°ì¡´ `_` prefix(private) í•¨ìˆ˜ë¥¼ publicìœ¼ë¡œ ë…¸ì¶œí•´ì•¼ í•˜ë¯€ë¡œ ë„¤ì´ë° ê²€í†  í•„ìš”
- D-6, D-7: í—¬í¼ ì¶”ì¶œ ì‹œ ê¸°ì¡´ í•¨ìˆ˜ì˜ ë™ì‘ì´ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ ì£¼ì˜. ì¶”ì¶œ í›„ ë™ì¼ ì…ë ¥ì— ëŒ€í•´ ë™ì¼ ì¶œë ¥ ê²€ì¦ í•„ìˆ˜
- D-9: iterrows â†’ ë²¡í„°í™” ì‹œ ë¶€ë™ì†Œìˆ˜ì  ì—°ì‚° ìˆœì„œ ë³€ê²½ìœ¼ë¡œ ê·¹ë¯¸í•œ ì°¨ì´ ê°€ëŠ¥. `pytest.approx`ë¡œ í—ˆìš© ë²”ìœ„ ë‚´ í™•ì¸

## 8) ë©”ëª¨(Notes)

- ì´ ê³„íšì„œëŠ” `PROJECT_ANALYSIS_REPORT.md`ì˜ D-1, D-6, D-7, D-9, E-4 í•­ëª©ì„ ëŒ€ìƒìœ¼ë¡œ í•¨
- D-3(ì›Œí¬í¬ì›Œë“œ ìŠ¤í¬ë¦½íŠ¸ í†µí•©), D-4/D-5(íŒŒì¼ ë¶„í• ), C-1~3(CLI ë¡œì§ ë¶„ë¦¬)ì€ ë³„ë„ ê³„íšì„œë¡œ ë¶„ë¦¬

### ì§„í–‰ ë¡œê·¸ (KST)

- 2026-02-20 20:00: ê³„íšì„œ ì´ˆì•ˆ ì‘ì„±

---
