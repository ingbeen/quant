# CLI 스크립트 계층 가이드

> 이 문서는 `scripts/` 디렉토리의 CLI 스크립트 계층에 대한 상세 가이드입니다.
> 프로젝트 전반의 공통 규칙은 [루트 CLAUDE.md](../CLAUDE.md)를 참고하세요.

## 계층 목적

CLI 스크립트 계층은 사용자와의 인터페이스를 담당하며,
비즈니스 로직을 호출하고 실행 결과를 사용자에게 전달합니다.

---

## 핵심 책임

### 1. 사용자 인터페이스
- 명령행 인자 파싱
- 사용자 입력 검증
- 실행 옵션 해석

### 2. 실행 환경 설정
- 로거 초기화
- 로그 레벨 설정
- 환경 변수 처리

### 3. 비즈니스 로직 호출
- 적절한 도메인 모듈 선택
- 파라미터 전달
- 결과 수령

### 4. 결과 표시
- 성공/실패 메시지
- 요약 통계 출력
- 테이블 형식 결과 표시

### 5. 예외 처리
- 모든 예외를 캐치하여 사용자 친화적 메시지로 변환
- 스택 트레이스 로깅
- 적절한 종료 코드 반환

---

## 표준 구조

### 필수 구성 요소

**임포트 섹션**:
- 표준 라이브러리
- 도메인 모듈
- 유틸리티 모듈
- 상수 모듈

**로거 초기화**:
- 모듈 레벨에서 로거 생성
- 예외 처리 데코레이터가 자동 감지

**main 함수**:
- 데코레이터 적용
- 종료 코드 반환 (0=성공, 1=실패)
- 명확한 단계별 로직

**진입점 보호**:
- `if __name__ == "__main__"` 사용
- 병렬 처리 환경 고려

### 실행 흐름

1. 로거 초기화
2. 명령행 인자 파싱 (필요 시)
3. 데이터 로딩
4. 비즈니스 로직 호출
5. 결과 표시
6. 성공 코드 반환

---

## 도메인별 스크립트

### 데이터 수집 (data/)
- 외부 소스에서 데이터 다운로드
- 엄격한 검증 수행
- 검증 통과 후 저장
- 다운로드 통계 출력

### 백테스트 (backtest/)
- 전략 파라미터 설정
- 단일 백테스트 또는 그리드 탐색 실행
- 성과 지표 계산
- 결과 요약 및 저장

### 레버리지 시뮬레이션 (tqqq/)
- 합성 데이터 생성
- 검증 및 비교
- 비용 모델 최적화
- 대시보드 실행

---

## 코딩 규칙

### 로깅 정책

**레벨 사용**:
- DEBUG: 실행 흐름, 데이터 처리
- WARNING: 경고성 메시지
- ERROR: 예외 발생 시 (데코레이터가 자동 처리)

**금지 사항**:
- INFO 레벨 사용 금지
- 이모지 사용 금지

### 예외 처리

**데코레이터 사용**:
- main 함수에 데코레이터 적용
- try-except 블록 불필요
- 자동 로깅 및 종료 코드 처리

**예외 전파**:
- 비즈니스 로직에서 발생한 예외를 그대로 전파
- 변환하거나 숨기지 않음

### 명령행 인자

**argparse 사용**:
- 명확한 도움말
- 타입 지정
- 기본값 설정
- 검증 로직

### 출력 형식

**요약 통계**:
- 주요 지표를 간결하게 표시
- 구분선으로 섹션 분리

**테이블 출력**:
- 테이블 로거 사용
- 한글/영문 혼용 시 폭 계산
- 정렬 일관성

---

## 제약사항

### 비즈니스 로직 분리
- CLI 계층에 도메인 로직 포함 금지
- 단순히 비즈니스 로직 호출만 담당

### 에러 로깅
- CLI 계층만 ERROR 레벨 로그 출력
- 비즈니스 로직은 예외만 발생

### 종료 코드
- 성공 시 0 반환 필수
- 실패 시 1 반환 필수
- 데코레이터가 자동 처리

### 사용자 메시지
- 한글 사용
- 명확하고 구체적
- 액션 가능한 정보 포함

---

## 확장 가이드

### 새로운 스크립트 추가

1. 적절한 도메인 디렉토리 선택
2. 표준 구조 따라 작성
3. 로거 초기화
4. main 함수에 데코레이터 적용
5. 비즈니스 로직 호출
6. 결과 표시
7. 진입점 보호

### 명령행 옵션 추가

1. argparse 파서 정의
2. 옵션 추가 (타입, 기본값, 도움말)
3. 파싱 결과 검증
4. 비즈니스 로직에 전달

### 출력 개선

1. 테이블 로거 활용
2. 컬럼 정의 (폭, 정렬)
3. 명확한 섹션 구분
4. 요약 통계 제공
