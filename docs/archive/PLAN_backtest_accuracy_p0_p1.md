# Implementation Plan: ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ ì •í™•ë„ ê°œì„  (P0~P1)

> ì‘ì„±/ìš´ì˜ ê·œì¹™(SoT): ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
> (ì´ í…œí”Œë¦¿ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì–‘ì‹ì˜ ê³„íšì„œë¥¼ ë§Œë“¤ ë•Œë„ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ í¬ì¸í„°ë¡œ ë‘ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.)

**ìƒíƒœ**: âœ… Done
**ì‘ì„±ì¼**: 2025-12-26 14:30
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-26 16:45
**ê´€ë ¨ ë²”ìœ„**: backtest (ì „ëµ ì—”ì§„ í•µì‹¬ ë¡œì§)
**ê´€ë ¨ ë¬¸ì„œ**: src/qbt/backtest/CLAUDE.md, tests/CLAUDE.md

---

## 0) ê³ ì • ê·œì¹™ (ì´ planì€ ë°˜ë“œì‹œ ì•„ë˜ ê·œì¹™ì„ ë”°ë¥¸ë‹¤)

> ğŸš« **ì‚­ì œ ê¸ˆì§€ + ìˆ˜ì • ê¸ˆì§€**
> ì´ ì„¹ì…˜(0)ì€ ì§€ì›Œì§€ë©´ ì•ˆ ë  ë¿ë§Œ ì•„ë‹ˆë¼ **ë¬¸êµ¬ê°€ ìˆ˜ì •ë˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**
> ê·œì¹™ì˜ ìƒì„¸ ì •ì˜/ì˜ˆì™¸ëŠ” ë°˜ë“œì‹œ [docs/CLAUDE.md](../CLAUDE.md)ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

- Validationì—ì„œ `poetry run ruff check .` ë˜ëŠ” `./run_tests.sh`ê°€ ì‹¤íŒ¨í•˜ë©´ **í•´ë‹¹ Phaseì—ì„œ ì¦‰ì‹œ ìˆ˜ì • í›„ ì¬ê²€ì¦**í•œë‹¤.
- Phase 0ì€ "ë ˆë“œ(ì˜ë„ì  ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸)" í—ˆìš©, Phase 1ë¶€í„°ëŠ” **ê·¸ë¦° ìœ ì§€**ë¥¼ ì›ì¹™ìœ¼ë¡œ í•œë‹¤.
- ì´ë¯¸ ìƒì„±ëœ planì€ **ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™¸ ìˆ˜ì • ê¸ˆì§€**(ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ ìƒˆ plan ì‘ì„±).
- ìŠ¹ì¸ ìš”ì²­ì„ í•˜ê¸° ì „ **ë°˜ë“œì‹œ plan ì²´í¬ë°•ìŠ¤ë¥¼ ìµœì‹ í™”**í•œë‹¤(ì²´í¬ ì—†ì´ ìŠ¹ì¸ ìš”ì²­ ê¸ˆì§€).
- ìŠ¤í‚µì€ ê°€ëŠ¥í•˜ë©´ **Phase ë¶„í•´ë¡œ ì œê±°**í•œë‹¤. ìŠ¤í‚µì´ ë‚¨ì•„ìˆìœ¼ë©´ **Done ì²˜ë¦¬/DoD ì²´í¬ ê¸ˆì§€**.

---

## 1) ëª©í‘œ(Goal)

- [x] equity_df, trades_df, summary(final_capital) ê°„ ì¼ê´€ì„± ë³´ì¥
- [x] hold_days ë¡œì§ì˜ ë£©ì–´í—¤ë“œ ì œê±° (ìˆœì°¨ ê²€ì¦ ë°©ì‹ìœ¼ë¡œ ì „í™˜) - Phase 2 ì™„ë£Œ
- [x] ë™ì  hold_days ì¦ê°€ëŸ‰ ìƒìˆ˜ ë°˜ì˜ (HOLD_DAYS_INCREMENT_PER_BUY)
- [x] ì²« ìœ íš¨ êµ¬ê°„ì—ì„œ prev band ì´ˆê¸°í™” ê°œì„ 

## 2) ë¹„ëª©í‘œ(Non-Goals)

- ì „ëµ íŒŒë¼ë¯¸í„° ìµœì í™” (ë²„í¼ì¡´ ë¹„ìœ¨, hold_days ê°’ ë“± íŠœë‹)
- ìƒˆë¡œìš´ ì „ëµ íƒ€ì… ì¶”ê°€
- ì„±ëŠ¥ ìµœì í™” (ë³‘ë ¬ ì²˜ë¦¬ ê°œì„  ë“±)
- UI/CLI ë³€ê²½
- ë°ì´í„° ë‹¤ìš´ë¡œë“œ/ê²€ì¦ ë¡œì§ ë³€ê²½

## 3) ë°°ê²½/ë§¥ë½(Context)

### í˜„ì¬ ë¬¸ì œì  / ë™ê¸°

**ë¬¸ì œ 1: ë°±í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ì‹œ ê²°ê³¼ ë¶ˆì¼ì¹˜**
- `run_buffer_strategy()` ì¢…ë£Œ ì‹œ ë§ˆì§€ë§‰ í¬ì§€ì…˜ì„ ê°•ì œì²­ì‚°í•˜ì—¬ trades_dfì— "end_of_data" ê±°ë˜ ì¶”ê°€
- ê·¸ëŸ¬ë‚˜ equity_dfì™€ summary.final_capitalì€ ë§ˆì§€ë§‰ equity ê¸°ë¡ ì‹œì ì˜ ê°’ ì‚¬ìš© (ê°•ì œì²­ì‚° ë¯¸ë°˜ì˜)
- ê²°ê³¼: trades_dfì˜ ë§ˆì§€ë§‰ ê±°ë˜ ì´í›„ ìë³¸ê³¼ equity_df/summaryì˜ final_capitalì´ ë¶ˆì¼ì¹˜

**ë¬¸ì œ 2: hold_days ë¡œì§ì˜ ë£©ì–´í—¤ë“œ**
- í˜„ì¬ `check_hold_condition()` í•¨ìˆ˜ëŠ” ëŒíŒŒ ë°œìƒ ì‹œì (iì¼)ì—ì„œ ë¯¸ë˜ êµ¬ê°„(i+1 ~ i+hold_days)ì„ í•œ ë²ˆì— ì¡°íšŒ
- ì´ëŠ” ë¯¸ë˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë£©ì–´í—¤ë“œë¡œ, ì „ëµ ì„±ê³¼ë¥¼ ì™œê³¡í•  ê°€ëŠ¥ì„± ìˆìŒ
- ì‹¤ì œ ê±°ë˜ì—ì„œëŠ” ë§¤ì¼ ìˆœì°¨ì ìœ¼ë¡œ ì¡°ê±´ì„ í™•ì¸í•´ì•¼ í•¨

**ë¬¸ì œ 3: ë™ì  hold_days ì¦ê°€ ìƒìˆ˜ ë¯¸ë°˜ì˜**
- `HOLD_DAYS_INCREMENT_PER_BUY = 1` ìƒìˆ˜ê°€ constants.pyì— ì •ì˜ë˜ì–´ ìˆìŒ
- ê·¸ëŸ¬ë‚˜ ì‹¤ì œ ê³„ì‚°ì€ `params.hold_days + recent_buy_count`ë¡œ í•˜ë“œì½”ë”©
- ì •ì±… ë³€ê²½ ì‹œ ìƒìˆ˜ë§Œ ë°”ê¿”ë„ ë°˜ì˜ë˜ì–´ì•¼ í•˜ë‚˜ í˜„ì¬ëŠ” ì½”ë“œ ìˆ˜ì • í•„ìš”

**ë¬¸ì œ 4: ì²« ìœ íš¨ êµ¬ê°„ prev band ì´ˆê¸°í™”**
- ë£¨í”„ ì‹œì‘ ì‹œ `prev_upper_band = None`, `prev_lower_band = None`ìœ¼ë¡œ ì´ˆê¸°í™”
- ì²« ë²ˆì§¸ ìœ íš¨í•œ ì‹ í˜¸ ê¸°íšŒë¥¼ ë†“ì¹  ê°€ëŠ¥ì„± (i=1ì—ì„œ prev_upper_bandê°€ Noneì´ë©´ ì‹ í˜¸ ê°ì§€ ë¶ˆê°€)

### ì˜í–¥ë°›ëŠ” ê·œì¹™(ë°˜ë“œì‹œ ì½ê³  ì „ì²´ ìˆ™ì§€)

> ì•„ë˜ ë¬¸ì„œì— ê¸°ì¬ëœ ê·œì¹™ì„ **ëª¨ë‘ ìˆ™ì§€**í•˜ê³  ì¤€ìˆ˜í•©ë‹ˆë‹¤.
> (ê·œì¹™ì„ ìš”ì•½/ë‚˜ì—´í•˜ì§€ ë§ê³  "ë¬¸ì„œ ëª©ë¡"ë§Œ ë‘¡ë‹ˆë‹¤.)

- [x] `CLAUDE.md` (ë£¨íŠ¸)
- [x] ì‘ì—… ë„ë©”ì¸ `CLAUDE.md`: `src/qbt/backtest/CLAUDE.md`
- [x] í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€/ìˆ˜ì •í•œë‹¤ë©´ `tests/CLAUDE.md`
- [x] ë¬¸ì„œ ì‘ì„± ê·œì¹™: `docs/CLAUDE.md`

## 4) ì™„ë£Œ ì¡°ê±´(Definition of Done)

> Doneì€ "ì„œìˆ "ì´ ì•„ë‹ˆë¼ "ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ"ë¡œë§Œ íŒë‹¨í•©ë‹ˆë‹¤. (ì •ì˜/ì˜ˆì™¸ëŠ” docs/CLAUDE.md)

- [x] ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ì¶©ì¡±
  - [x] equity_df, trades_df, summary.final_capital ì¼ê´€ì„± í™•ë³´
  - [x] hold_days ë£©ì–´í—¤ë“œ ì œê±° (ìˆœì°¨ ê²€ì¦) - Phase 2 ì™„ë£Œ
  - [x] HOLD_DAYS_INCREMENT_PER_BUY ìƒìˆ˜ ë°˜ì˜
  - [x] prev band ì´ˆê¸°í™” ê°œì„ 
- [x] íšŒê·€/ì‹ ê·œ í…ŒìŠ¤íŠ¸ ì¶”ê°€
  - [x] ì¢…ë£Œ ì‹œ ì¼ê´€ì„± í…ŒìŠ¤íŠ¸ (test_backtest_end_consistency)
  - [x] hold_days ë£©ì–´í—¤ë“œ ë°©ì§€ í…ŒìŠ¤íŠ¸ (test_hold_days_no_lookahead) - Phase 2ì—ì„œ í™œì„±í™”
  - [x] ë™ì  ì¦ê°€ ìƒìˆ˜ ë°˜ì˜ í…ŒìŠ¤íŠ¸ (test_dynamic_hold_days_uses_constant)
  - [x] ì²« ì‹ í˜¸ ê°ì§€ í…ŒìŠ¤íŠ¸ (test_first_valid_signal_detection)
- [x] `./run_tests.sh` í†µê³¼ (103 passed - ì „ì²´ í†µê³¼)
- [x] `poetry run ruff check .` í†µê³¼
- [x] `poetry run black .` ì‹¤í–‰ ì™„ë£Œ
- [x] í•„ìš”í•œ ë¬¸ì„œ ì—…ë°ì´íŠ¸ (src/qbt/backtest/CLAUDE.md ì—…ë°ì´íŠ¸)
- [x] plan ì²´í¬ë°•ìŠ¤ ìµœì‹ í™” (Phase/DoD/Validation ëª¨ë‘ ë°˜ì˜)

## 5) ë³€ê²½ ë²”ìœ„(Scope)

### ë³€ê²½ ëŒ€ìƒ íŒŒì¼(ì˜ˆìƒ)

- `src/qbt/backtest/strategy.py`
  - `run_buffer_strategy()`: ë©”ì¸ ë¡œì§ ìˆ˜ì •
  - `check_hold_condition()`: ì‚­ì œ ë˜ëŠ” ëŒ€í­ ìˆ˜ì •
  - hold_days ìƒíƒœë¨¸ì‹  ë¡œì§ ì¶”ê°€
  - ë™ì  íŒŒë¼ë¯¸í„° ê³„ì‚° ìˆ˜ì • (ìƒìˆ˜ ë°˜ì˜)
  - prev band ì´ˆê¸°í™” ë¡œì§ ìˆ˜ì •
- `src/qbt/backtest/constants.py`
  - í•„ìš”ì‹œ ìƒìˆ˜ ì¶”ê°€/ëª…í™•í™”
- `src/qbt/backtest/CLAUDE.md`
  - hold_days ê·œì¹™ ì—…ë°ì´íŠ¸ (ë£©ì–´í—¤ë“œ ë°©ì§€ ëª…ì‹œ)
  - ë°±í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ê·œì¹™ ëª…í™•í™”
- `tests/test_strategy.py`
  - ì‹ ê·œ í…ŒìŠ¤íŠ¸ ì¶”ê°€ (4ê°œ ì´ìƒ)
  - ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ê²€í†  ë° ì—…ë°ì´íŠ¸

### ë°ì´í„°/ê²°ê³¼ ì˜í–¥

- **CSV ìŠ¤í‚¤ë§ˆ ë³€ê²½**: ì—†ìŒ
- **ê²°ê³¼ ê°’ ë³€ê²½ ê°€ëŠ¥ì„±**: ìˆìŒ
  - hold_days ë¡œì§ ë³€ê²½ìœ¼ë¡œ ê±°ë˜ íƒ€ì´ë°ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
  - ë™ì  hold_days ê³„ì‚° ë°©ì‹ ë³€ê²½ìœ¼ë¡œ ì¼ë¶€ íŒŒë¼ë¯¸í„° ì¡°í•©ì˜ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ
  - ì¢…ë£Œ ì²˜ë¦¬ ì •ì±… ë³€ê²½ìœ¼ë¡œ final_capitalì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ (ë” ì •í™•í•´ì§)
- **ê¸°ì¡´ ê²°ê³¼ ë¹„êµ**: í•„ìš”
  - ëŒ€í‘œ íŒŒë¼ë¯¸í„° ì¡°í•©ìœ¼ë¡œ before/after ë¹„êµ (ì°¨ì´ ë¶„ì„)

## 6) ë‹¨ê³„ë³„ ê³„íš(Phases)

### Phase 0 â€” ì¸ë°”ë¦¬ì–¸íŠ¸/ì •ì±…ì„ í…ŒìŠ¤íŠ¸ë¡œ ë¨¼ì € ê³ ì •(ë ˆë“œ)

> í•µì‹¬ ì¸ë°”ë¦¬ì–¸íŠ¸: equity/final_capital ì •ì˜, hold_days ë£©ì–´í—¤ë“œ ë°©ì§€, ë™ì  íŒŒë¼ë¯¸í„° ìƒìˆ˜ ë°˜ì˜

**ì‘ì—… ë‚´ìš©**:

- [x] ë°±í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ê·œì¹™ì„ CLAUDE.mdì— ëª…í™•íˆ ê¸°ë¡
  - "ë§ˆì§€ë§‰ ë‚  í¬ì§€ì…˜ì´ ë‚¨ì•„ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë‘”ë‹¤"
  - "final_capital = cash + position_shares Ã— last_close (í•­ìƒ)"
  - "ê°•ì œì²­ì‚° ì—†ìŒ (trades ìƒì„± ì•ˆ í•¨)"
- [x] hold_days ë£©ì–´í—¤ë“œ ë°©ì§€ ê·œì¹™ì„ CLAUDE.mdì— ëª…í™•íˆ ê¸°ë¡
  - "iì¼ì— i+1 ~ i+Hë¥¼ ë¯¸ë¦¬ ê²€ì‚¬í•˜ì—¬ pendingì„ ì„ ì ì¬í•˜ë©´ ì•ˆ ë¨"
  - "ë§¤ì¼ ìˆœì°¨ì ìœ¼ë¡œ ìœ ì§€ì¡°ê±´ ì²´í¬"
- [x] ë™ì  íŒŒë¼ë¯¸í„° ì¦ê°€ ê·œì¹™ì„ CLAUDE.mdì— ëª…í™•íˆ ê¸°ë¡
  - "HOLD_DAYS_INCREMENT_PER_BUY ìƒìˆ˜ ì‚¬ìš©"
  - "params.hold_days + (recent_buy_count Ã— HOLD_DAYS_INCREMENT_PER_BUY)"
- [x] ì‹ ê·œ í…ŒìŠ¤íŠ¸ ì¶”ê°€ (ì˜ë„ì  ì‹¤íŒ¨ í—ˆìš©)
  - [x] `test_backtest_end_consistency`: equity_df, trades_df, summary ì¼ê´€ì„± ê²€ì¦ (FAILED - ì˜ˆìƒëŒ€ë¡œ)
  - [x] `test_hold_days_no_lookahead`: hold_days ìˆœì°¨ ê²€ì¦ í™•ì¸ (SKIPPED - Phase 2ì—ì„œ í™œì„±í™”)
  - [x] `test_dynamic_hold_days_uses_constant`: ìƒìˆ˜ ë°˜ì˜ í™•ì¸ (PASSED - ì´ë¯¸ ì˜¬ë°”ë¦„)
  - [x] `test_first_valid_signal_detection`: ì²« ìœ íš¨ êµ¬ê°„ ì‹ í˜¸ ê°ì§€ (PASSED - ì´ë¯¸ ì˜¬ë°”ë¦„)

**Validation**:

- [x] `poetry run ruff check .` (í†µê³¼)
- [x] `./run_tests.sh` (101 passed, 1 failed, 1 skipped - ì˜ˆìƒëŒ€ë¡œ)

---

### Phase 1 â€” ë°±í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ì²˜ë¦¬ ì •ì±… êµ¬í˜„ (ê·¸ë¦° ìœ ì§€)

**ì‘ì—… ë‚´ìš©**:

- [x] `run_buffer_strategy()` ì¢…ë£Œ ë¡œì§ ìˆ˜ì •
  - ë§ˆì§€ë§‰ í¬ì§€ì…˜ ê°•ì œì²­ì‚° ì½”ë“œ ì‚­ì œ (894~928ì¤„)
  - equity_dfëŠ” ë§ˆì§€ë§‰ ë‚ ê¹Œì§€ ì •ìƒ ê¸°ë¡ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
  - summary.final_capitalì€ equity_dfì˜ ë§ˆì§€ë§‰ equity ê°’ ì‚¬ìš© (ì´ë¯¸ ê·¸ëŸ¬í•¨)
- [x] `run_buy_and_hold()` ì¢…ë£Œ ë¡œì§ ê²€í†  ë° ì¼ê´€ì„± í™•ë³´
  - í˜„ì¬ëŠ” ë§ˆì§€ë§‰ ë‚  ì¢…ê°€ì— ëª…ì‹œì  ë§¤ë„ (487~499ì¤„)
  - Buy & HoldëŠ” ë²¤ì¹˜ë§ˆí¬ì´ë¯€ë¡œ ëª…ì‹œì  ë§¤ë„ ìœ ì§€ (ë³€ê²½ ë¶ˆí•„ìš”)
  - equity ê³„ì‚°ì´ ì¼ê´€ë˜ê²Œ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸
- [x] ê¸°ì¡´ ê°•ì œì²­ì‚° í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
  - `test_forced_liquidation_at_end` ìˆ˜ì • (ì •ì±… ë³€ê²½ ë°˜ì˜)
  - `test_forced_liquidation_equity_consistency` ìˆ˜ì • (ì •ì±… ë³€ê²½ ë°˜ì˜)
- [x] ê´€ë ¨ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
  - `test_backtest_end_consistency` í†µê³¼

**Validation**:

- [x] `poetry run ruff check .` (í†µê³¼)
- [x] `./run_tests.sh` (102 passed, 1 skipped - ì „ì²´ í†µê³¼)

---

### Phase 2 â€” hold_days ë£©ì–´í—¤ë“œ ì œê±° (ìƒíƒœë¨¸ì‹  ë°©ì‹) (ê·¸ë¦° ìœ ì§€)

**ìƒíƒœ**: âœ… ì™„ë£Œ

**ì‘ì—… ë‚´ìš©**:

- [x] ìƒíƒœë¨¸ì‹  ë³€ìˆ˜ ì¶”ê°€
  - `hold_state: dict | None` - ìœ ì§€ì¡°ê±´ ì¶”ì  ìƒíƒœ
  - êµ¬ì¡°: `{"start_date": date, "days_passed": int, "buffer_pct": float, "hold_days_required": int}`
  - ì¶”ê°€: `entry_hold_days`, `entry_recent_buy_count` (ê±°ë˜ ê¸°ë¡ìš©)
- [x] ë§¤ì¼ ìˆœì°¨ ê²€ì¦ ë¡œì§ êµ¬í˜„
  - ëŒíŒŒ ë°œìƒ ì‹œ: hold_state ì´ˆê¸°í™” (days_passed=0)
  - ë§¤ì¼: hold_stateê°€ ì¡´ì¬í•˜ë©´ ìœ ì§€ì¡°ê±´ ì²´í¬
    - ì¡°ê±´ í†µê³¼: days_passed += 1
    - ì¡°ê±´ ì‹¤íŒ¨: hold_state = None (ë¦¬ì…‹)
    - days_passed == hold_days_required: pending_order ìƒì„± í›„ hold_state = None
- [x] `check_hold_condition()` í•¨ìˆ˜ DEPRECATED í‘œì‹œ
  - ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
  - Docstringì— DEPRECATED ëª…ì‹œ
- [x] `_detect_buy_signal()`, `_detect_sell_signal()` ìˆ˜ì •
  - hold_days ì²´í¬ ë¡œì§ ì œê±° (ìƒíƒœë¨¸ì‹ ìœ¼ë¡œ ì´ë™)
  - ëŒíŒŒ ê°ì§€ë§Œ ìˆ˜í–‰
  - ë°˜í™˜ê°’ ë‹¨ìˆœí™”: boolë§Œ ë°˜í™˜
- [x] ê´€ë ¨ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
  - `test_hold_days_no_lookahead` í™œì„±í™” ë° í†µê³¼
  - ê¸°ì¡´ hold_days ê´€ë ¨ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼ (103 passed)

**Validation**:

- [x] `poetry run ruff check .` (í†µê³¼)
- [x] `./run_tests.sh` (103 passed - ì „ì²´ í†µê³¼)

---

### Phase 3 â€” ë™ì  íŒŒë¼ë¯¸í„° ì¦ê°€ ìƒìˆ˜ ë°˜ì˜ (ê·¸ë¦° ìœ ì§€)

**ì‘ì—… ë‚´ìš©**:

- [x] ë™ì  ë²„í¼ì¡´ ê³„ì‚° ê²€ì¦ (789~808ì¤„)
  - `current_buffer_pct = params.buffer_zone_pct + (recent_buy_count * BUFFER_INCREMENT_PER_BUY)`
  - ì´ë¯¸ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì–´ ìˆìŒ
- [x] ë™ì  hold_days ê³„ì‚° ìˆ˜ì • (789~808ì¤„)
  - ê¸°ì¡´: `current_hold_days = params.hold_days + recent_buy_count`
  - ë³€ê²½: `current_hold_days = params.hold_days + (recent_buy_count * HOLD_DAYS_INCREMENT_PER_BUY)`
  - import ì¶”ê°€: `HOLD_DAYS_INCREMENT_PER_BUY`
- [x] ê´€ë ¨ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
  - `test_dynamic_hold_days_uses_constant` í†µê³¼

**Validation**:

- [x] `poetry run ruff check .` (í†µê³¼)
- [x] `./run_tests.sh` (102 passed, 1 skipped - ì „ì²´ í†µê³¼)

---

### Phase 4 â€” prev band ì´ˆê¸°í™” ê°œì„  (ê·¸ë¦° ìœ ì§€)

**ì‘ì—… ë‚´ìš©**:

- [x] prev band ì´ˆê¸°í™” ë¡œì§ ìˆ˜ì •
  - ì²« ë‚ (i=0)ì— ë°´ë“œ ê³„ì‚°í•˜ì—¬ prev_upper_band, prev_lower_band ì´ˆê¸°í™”
  - i=1ë¶€í„° ë£¨í”„ ì‹œì‘í•  ë•Œ ì´ë¯¸ prev ê°’ì´ ì¡´ì¬
  - ì²« ë‚  ì—ì¿¼í‹° ê¸°ë¡ ì‹œì—ë„ ë°´ë“œ ê°’ í¬í•¨
- [x] ê´€ë ¨ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
  - `test_first_valid_signal_detection` í†µê³¼

**Validation**:

- [x] `poetry run ruff check .` (í†µê³¼)
- [x] `./run_tests.sh` (102 passed, 1 skipped - ì „ì²´ í†µê³¼)

---

### Phase 5 â€” ë¬¸ì„œ ì •ë¦¬ ë° ìµœì¢… ê²€ì¦

**ì‘ì—… ë‚´ìš©**:

- [x] `src/qbt/backtest/CLAUDE.md` ì—…ë°ì´íŠ¸
  - ì„¹ì…˜ 7 "ë§ˆì§€ë§‰ ë‚  ê·œì¹™" ì—…ë°ì´íŠ¸ (ê°•ì œì²­ì‚° ì œê±° ë°˜ì˜) - Phase 0ì—ì„œ ì™„ë£Œ
  - ì„¹ì…˜ 6 "hold_days ê·œì¹™" ì—…ë°ì´íŠ¸ (ë£©ì–´í—¤ë“œ ë°©ì§€ ëª…ì‹œ) - Phase 0ì—ì„œ ì™„ë£Œ
  - ì„¹ì…˜ "ë™ì  ì¡°ì •" ì—…ë°ì´íŠ¸ (ìƒìˆ˜ ë°˜ì˜ ëª…ì‹œ) - Phase 0ì—ì„œ ì™„ë£Œ
- [x] README.md í™•ì¸ (ë³€ê²½ ë¶ˆí•„ìš”)
- [x] `poetry run black .` ì‹¤í–‰ (1 file reformatted)
- [x] ìµœì¢… ê²€ì¦
  - ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (102 passed, 1 skipped)

**Validation**:

- [x] `poetry run ruff check .` (í†µê³¼)
- [x] `./run_tests.sh` (102 passed, 1 skipped - ì „ì²´ í†µê³¼)

#### Commit Messages (Final)

1. ë°±í…ŒìŠ¤íŠ¸ / ì¢…ë£Œ ì‹œ ê°•ì œì²­ì‚° ì œê±° (equity/trades/summary ì¼ê´€ì„± í™•ë³´)
2. ë°±í…ŒìŠ¤íŠ¸ / ë™ì  hold_days ì¦ê°€ëŸ‰ ìƒìˆ˜ ë°˜ì˜ (HOLD_DAYS_INCREMENT_PER_BUY)
3. ë°±í…ŒìŠ¤íŠ¸ / prev band ì´ˆê¸°í™” ê°œì„  (ì²« ì‹ í˜¸ ê°ì§€ ë³´ì¥)
4. ë°±í…ŒìŠ¤íŠ¸ / í…ŒìŠ¤íŠ¸ ì¶”ê°€ ë° ì—…ë°ì´íŠ¸ (ì¢…ë£Œ ì¼ê´€ì„±, ìƒìˆ˜ ë°˜ì˜, ì²« ì‹ í˜¸)
5. ë°±í…ŒìŠ¤íŠ¸ / CLAUDE.md ì—…ë°ì´íŠ¸ (ì¢…ë£Œ/ë™ì ì¡°ì • ê·œì¹™ ëª…í™•í™”)

## 7) ë¦¬ìŠ¤í¬(Risks)

**ë¦¬ìŠ¤í¬ 1: ê²°ê³¼ ê°’ ë³€ê²½**
- hold_days ë¡œì§ ë³€ê²½ìœ¼ë¡œ ê±°ë˜ íƒ€ì´ë° ë‹¬ë¼ì§
- ì™„í™”ì±…:
  - ëŒ€í‘œ íŒŒë¼ë¯¸í„° ì¡°í•©ìœ¼ë¡œ before/after ë¹„êµ
  - ë³€ê²½ ì´ìœ ì™€ ë°©í–¥ì„± ë¬¸ì„œí™” (ë” ì •í™•í•´ì§)
  - ê¸°ì¡´ grid_results.csv ë°±ì—… (ì„ íƒ)

**ë¦¬ìŠ¤í¬ 2: íšŒê·€ ê°€ëŠ¥ì„±**
- í•µì‹¬ ë¡œì§ ìˆ˜ì •ìœ¼ë¡œ ê¸°ì¡´ ë™ì‘ ì˜í–¥
- ì™„í™”ì±…:
  - Phase 0ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì¶”ê°€ (ë ˆë“œ)
  - Phase 1~4ì—ì„œ ê·¸ë¦° ìœ ì§€ ì›ì¹™
  - ë§¤ Phaseë§ˆë‹¤ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

**ë¦¬ìŠ¤í¬ 3: ì„±ëŠ¥ ì €í•˜**
- ìƒíƒœë¨¸ì‹  ë°©ì‹ìœ¼ë¡œ ë³€ê²½ ì‹œ ë£¨í”„ ë³µì¡ë„ ì¦ê°€ ê°€ëŠ¥
- ì™„í™”ì±…:
  - ì„±ëŠ¥ ìµœì í™”ëŠ” Non-Goal
  - í•„ìš”ì‹œ ë³„ë„ planìœ¼ë¡œ ì§„í–‰
  - í˜„ì¬ëŠ” ì •í™•ì„± ìš°ì„ 

**ë¦¬ìŠ¤í¬ 4: í…ŒìŠ¤íŠ¸ ì„¤ê³„ ì˜¤ë¥˜**
- ë£©ì–´í—¤ë“œ ë°©ì§€ í…ŒìŠ¤íŠ¸ ì„¤ê³„ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ
- ì™„í™”ì±…:
  - ê°„ë‹¨í•œ ì¼€ì´ìŠ¤ë¶€í„° ì‹œì‘ (hold_days=1, ë°ì´í„° 3~4í–‰)
  - ì˜ˆìƒ ê²°ê³¼ë¥¼ ìˆ˜ì‘ì—…ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ê²€ì¦
  - í…ŒìŠ¤íŠ¸ docstringì— ê³„ì‚° ê³¼ì • ëª…ì‹œ

## 8) ë©”ëª¨(Notes)

### í•µì‹¬ ê²°ì • ì‚¬í•­

**ê²°ì • 1: ë°±í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ì‹œ ê°•ì œì²­ì‚° ì œê±°**
- ì´ìœ : equity_df, trades_df, summary.final_capital ê°„ ì¼ê´€ì„± í™•ë³´
- ì˜í–¥: final_capitalì´ "í˜„ê¸ˆ + í‰ê°€ì•¡" ê¸°ì¤€ìœ¼ë¡œ í†µì¼
- íŠ¸ë ˆì´ë“œì˜¤í”„: ë§ˆì§€ë§‰ ê±°ë˜ê°€ trades_dfì— ê¸°ë¡ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ (ì •ì±…ìƒ ì˜¬ë°”ë¦„)

**ê²°ì • 2: hold_days ìƒíƒœë¨¸ì‹  ë°©ì‹**
- ì´ìœ : ë£©ì–´í—¤ë“œ ì œê±°, ì‹¤ì œ ê±°ë˜ì™€ ìœ ì‚¬í•œ ìˆœì°¨ ê²€ì¦
- ì˜í–¥: ë§¤ì¼ ì¡°ê±´ ì²´í¬ë¡œ ì •í™•ì„± í–¥ìƒ
- íŠ¸ë ˆì´ë“œì˜¤í”„: ì½”ë“œ ë³µì¡ë„ ì•½ê°„ ì¦ê°€

**ê²°ì • 3: HOLD_DAYS_INCREMENT_PER_BUY ìƒìˆ˜ ì‚¬ìš©**
- ì´ìœ : ì •ì±… ë³€ê²½ ì‹œ ìƒìˆ˜ë§Œ ìˆ˜ì •í•˜ë©´ ë˜ë„ë¡
- ì˜í–¥: ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- íŠ¸ë ˆì´ë“œì˜¤í”„: ì—†ìŒ (ë²„ê·¸ ìˆ˜ì •)

**ê²°ì • 4: prev band ì´ˆê¸°í™” ê°œì„ **
- ì´ìœ : ì²« ìœ íš¨ ì‹ í˜¸ ê°ì§€ ë³´ì¥
- ì˜í–¥: ë°±í…ŒìŠ¤íŠ¸ ì‹œì‘ ë¶€ë¶„ ì •í™•ì„± í–¥ìƒ
- íŠ¸ë ˆì´ë“œì˜¤í”„: ì—†ìŒ (ë²„ê·¸ ìˆ˜ì •)

### ì°¸ê³  ë§í¬

- ë°±í…ŒìŠ¤íŠ¸ ë„ë©”ì¸ ê·œì¹™: [src/qbt/backtest/CLAUDE.md](../../src/qbt/backtest/CLAUDE.md)
- í…ŒìŠ¤íŠ¸ ê·œì¹™: [tests/CLAUDE.md](../../tests/CLAUDE.md)
- í”„ë¡¬í”„íŠ¸ ì›ë¬¸: ì„¸ì…˜ 1 í”„ë¡¬í”„íŠ¸ (ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ ì •í™•ë„ P0~P1)

### ì§„í–‰ ë¡œê·¸ (KST)

- 2025-12-26 14:30: plan ì´ˆì•ˆ ì‘ì„± ì™„ë£Œ
- 2025-12-26 14:35: Phase 0 ì™„ë£Œ (í…ŒìŠ¤íŠ¸ ì¶”ê°€, CLAUDE.md ì—…ë°ì´íŠ¸, 101 passed/1 failed/1 skipped)
- 2025-12-26 14:40: Phase 1 ì™„ë£Œ (ê°•ì œì²­ì‚° ì œê±°, ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸, 102 passed/1 skipped)
- 2025-12-26 14:45: Phase 3 ì™„ë£Œ (ë™ì  hold_days ìƒìˆ˜ ë°˜ì˜, 102 passed/1 skipped)
- 2025-12-26 14:50: Phase 4 ì™„ë£Œ (prev band ì´ˆê¸°í™” ê°œì„ , 102 passed/1 skipped)
- 2025-12-26 15:00: Phase 5 ì™„ë£Œ (Black ì‹¤í–‰, ìµœì¢… ê²€ì¦, 102 passed/1 skipped)
- 2025-12-26 16:30: Phase 2 ì‘ì—… ì‹œì‘ (hold_days ë£©ì–´í—¤ë“œ ì œê±°, ìƒíƒœë¨¸ì‹  ë°©ì‹)
- 2025-12-26 16:35: Phase 2 ì™„ë£Œ (ìƒíƒœë¨¸ì‹  ë¡œì§ êµ¬í˜„, test_hold_days_no_lookahead í™œì„±í™”, 103 passed)
- 2025-12-26 16:45: ì „ì²´ ì‘ì—… ì™„ë£Œ (ëª¨ë“  Phase ì™„ë£Œ, 103 passed, Black ì‹¤í–‰)
